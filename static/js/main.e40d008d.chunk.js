(this.webpackJsonpreact_ag_image=this.webpackJsonpreact_ag_image||[]).push([[0],[,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),o=n(7),r=n.n(o),c=(n(13),n(3));n(14);function s(){return new Worker(n.p+"static/js/test.worker.a4bb249b.js")}n(8);var l=n(2);function u(e){return 3===e.length?"rgb(".concat(e[0],",").concat(e[1],",").concat(e[2],")"):"rgba(".concat(e[0],",").concat(e[1],",").concat(e[2],",").concat(e[3],")")}function d(e,t){if(e&&0!==t.vertices.length){e.fillStyle=u(t.color),e.beginPath();var n=t.vertices[0];e.moveTo(n.x,n.y);for(var a=1;a<t.vertices.length;a++)n=t.vertices[a],e.lineTo(n.x,n.y);e.closePath(),e.fill()}}function f(e,t,n){var a=t/e;return n&&(e>=n||t>=n)?a>1?{width:Math.round(n/a),height:n,ratio:a}:{width:n,height:Math.round(n*a),ratio:a}:{width:e,height:t,ratio:a}}n(15);var b=n(0);function m(e){var t=e.start,n=e.stop,i=e.links,o=e.isStopped,r=e.className,s=Object(a.useState)("https://my-image-url"),l=Object(c.a)(s,2),u=l[0],d=l[1];return Object(b.jsxs)("div",{className:r,children:[Object(b.jsx)("div",{children:Object(b.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t&&t(u)},children:[Object(b.jsx)("input",{type:"text",name:"image-url",value:u,onChange:function(e){return d(e.target.value)}}),Object(b.jsx)("button",{disabled:!o,type:"submit",id:"start-button",children:"Start"}),Object(b.jsx)("button",{disabled:o,type:"button",id:"stop-button",onClick:function(){n&&n()},children:"Stop"})]})}),Object(b.jsx)("div",{children:function(){var e=[];return i.forEach((function(t){var n=Object(b.jsxs)("button",{className:"link",value:t.link,onClick:function(e){d(e.currentTarget.value)},children:[" ",t.name," "]},t.name);e.push(n)})),e}()})]})}n(17);function g(e){var t=e.name,n=e.url,i=e.limit,o=e.onImageDrawn,r=e.onLoadingError,s=e.className,l=e.classNameOnError,u=Object(a.useRef)(null),d=Object(a.useState)(!1),m=Object(c.a)(d,2),g=m[0],j=m[1];return Object(a.useEffect)((function(){j(!1);var e=u.current;if(e){var t=e.getContext("2d"),a=new Image;a.crossOrigin="Anonymous",a.onload=function(){var n=f(a.width,a.height,i),r=n.width,c=n.height;0!==r&&0!==c||console.error("Fail to load the image"),e.width=r,e.height=c,t?(t.drawImage(a,0,0,r,c),null===o||void 0===o||o(a,r,c)):console.error("ctx is null the image can not be loaded")},a.src=n,a.onerror=function(){j(!0),r()}}}),[n,i,o,r]),Object(b.jsxs)("div",{children:[g&&Object(b.jsx)("div",{className:l,children:Object(b.jsxs)("p",{className:"error",children:["The image ",n," could not be loaded. Try with another URL."]})}),Object(b.jsx)("div",{className:s,children:Object(b.jsx)("canvas",{id:t,ref:u})})]})}function j(e){var t=e.name,n=e.width,i=e.height,o=e.ratioW,r=e.ratioH,c=e.drawingSteps,s=e.onImageDrawn,l=e.className,u=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e=u.current,t=e.getContext("2d");if(0!==n&&0!==i||console.error("Fail to create the drawing"),e.width=n,e.height=i,t){!function(e,t,n,a,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];e.clearRect(0,0,t,n),e.fillStyle="#000000",e.fillRect(0,0,t,n),e.scale(a,i),o.forEach((function(t){d(e,t)}))}(t,n,i,o,r,c);var a=t.getImageData(0,0,n,i);null===s||void 0===s||s(a)}else console.error("ctx is null the drawing can not be done")}),[n,i,o,r,c,s]),Object(b.jsx)("div",{children:Object(b.jsx)("canvas",{className:l,id:t,ref:u})})}function h(e){var t=e.name,n=e.width,i=e.height,o=e.ratioW,r=e.ratioH,c=e.data,s=e.className,l=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e=l.current,t=e.getContext("2d");0!==n&&0!==i||console.error("Fail to create the drawing"),e.width=n,e.height=i,t?function(e,t,n,a,i,o,r){e.clearRect(0,0,t,n),e.putImageData(o,0,0),e.scale(a,i),e.drawImage(r,0,0)}(t,n,i,o,r,c,e):console.error("ctx is null the drawing can not be done")}),[n,i,o,r,c]),Object(b.jsx)("div",{children:Object(b.jsx)("canvas",{className:s,id:t,ref:l})})}function p(e){var t=e.generation,n=e.fitness,a=e.ssim,i=e.pixelDiff,o=e.idBest,r=e.elapsedTimeForGeneration,c=e.notImprovingSince,s=e.className;return Object(b.jsxs)("div",{className:s,children:[Object(b.jsxs)("p",{children:[" Generation: ",t,c>0&&Object(b.jsxs)("span",{children:[" (not improving since ",c,") "]})]}),Object(b.jsxs)("p",{children:[" Simulation time: ",r," seconds "]}),Object(b.jsxs)("p",{children:[" Fitness: ",n," "]}),Object(b.jsxs)("p",{children:[" - SSIM: ",a," "]}),Object(b.jsxs)("p",{children:[" - Pixel Diff: ",i," "]}),Object(b.jsxs)("p",{children:[" idBest: ",o," "]})]})}n(18),n(19);function O(e){var t=e.defaultVal,n=e.min,i=e.max,o=e.step,r=e.label,s=e.id,l=e.name,u=e.onChange,d=Object(a.useState)(t),f=Object(c.a)(d,2),m=f[0],g=f[1];return Object(b.jsxs)("div",{className:"inputrange-wrapper",children:[Object(b.jsx)("label",{className:"inputrange-one",children:r}),Object(b.jsx)("input",{className:"inputrange-two",type:"range",id:s,name:l,min:n,max:i,step:o,value:m,onChange:function(e){var t=e.target.valueAsNumber;g(t),u(t)}}),Object(b.jsx)("span",{className:"inputrange-three",children:m})]})}function x(e){var t=e.population,n=e.selectCutoff,i=e.keepPreviousRatio,o=e.newIndividualRatio,r=e.crossoverParentRatio,s=e.mutationRate,u=e.vertexMovement,d=e.colorModificationRate,f=e.enableSsim,m=e.enablePixelDiff,g=e.ratioSsim,j=e.ratioPixelDiff,h=e.enableTransparency,p=e.nbVertex,x=e.nbPolygons,v=e.onValuesChange,w=e.className,C=Object(a.useState)({population:t,selectCutoff:n,keepPreviousRatio:i,newIndividualRatio:o,crossoverParentRatio:r,mutationRate:s,vertexMovement:u,colorModificationRate:d,enableSsim:f,enablePixelDiff:m,ratioSsim:g,ratioPixelDiff:j,enableTransparency:h,nbVertex:p,nbPolygons:x}),S=Object(c.a)(C,2),R=S[0],y=S[1];return Object(a.useEffect)((function(){console.log("use effect to update configuration "+JSON.stringify(R)),v(R)}),[R,v]),Object(b.jsxs)("div",{className:w,children:[Object(b.jsx)("h3",{children:" Genetic Algorithm "}),Object(b.jsx)(O,{id:"ga-population",name:"ga-population",label:"Population",min:10,max:300,defaultVal:R.population,step:1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{population:e}))}}),Object(b.jsx)(O,{id:"ga-selection-cutoff",name:"ga-selection-cutoff",label:"Selection cutoff",min:0,max:1,defaultVal:R.selectCutoff,step:.1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{selectCutoff:e}))}}),Object(b.jsx)(O,{id:"ga-keep-previous",name:"ga-keep-previous",label:"Keep previous individual",min:0,max:1,defaultVal:R.keepPreviousRatio,step:.1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{keepPreviousRatio:e}))}}),Object(b.jsx)(O,{id:"ga-new-individual",name:"ga-new-individual",label:"Generate new individual",min:0,max:1,defaultVal:R.newIndividualRatio,step:.1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{newIndividualRatio:e}))}}),Object(b.jsx)(O,{id:"ga-crossover-parent",name:"ga-crossover-parent",label:"Cross over main parent ratio",min:0,max:1,defaultVal:R.crossoverParentRatio,step:.1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{crossoverParentRatio:e}))}}),Object(b.jsx)(O,{id:"ga-mutation",name:"ga-mutation",label:"Mutation rate",min:0,max:1,defaultVal:R.mutationRate,step:.1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{mutationRate:e}))}}),Object(b.jsx)(O,{id:"ga-vertex-movement",name:"ga-vertex-movement",label:"Vertex movement",min:0,max:.5,defaultVal:R.vertexMovement,step:.1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{vertexMovement:e}))}}),Object(b.jsx)(O,{id:"ga-color-modification",name:"ga-color-modification",label:"Color modification",min:0,max:1,defaultVal:R.colorModificationRate,step:.1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{colorModificationRate:e}))}}),Object(b.jsx)("h3",{children:" Image rendering "}),Object(b.jsxs)("div",{children:[Object(b.jsx)("label",{className:"gaconfiguration-one",htmlFor:"ga-ssim",children:"SSIM:"}),Object(b.jsx)("input",{className:"gaconfiguration-three",type:"checkbox",id:"ga-ssim",value:"ssim",checked:R.enableSsim,onChange:function(e){y(Object(l.a)(Object(l.a)({},R),{},{enableSsim:e.target.checked}))}})]}),Object(b.jsxs)("div",{children:[Object(b.jsx)("label",{className:"gaconfiguration-one",htmlFor:"ga-pixeldiff",children:"Pixel differenciation:"}),Object(b.jsx)("input",{className:"gaconfiguration-three",type:"checkbox",id:"ga-pixeldiff",value:"pixeldiff",checked:R.enablePixelDiff,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{enablePixelDiff:e.target.checked}))}})]}),R.enableSsim&&R.enablePixelDiff&&Object(b.jsxs)("div",{children:[Object(b.jsx)(O,{id:"ga-ssim-ratio",name:"ga-ssim-ratio",label:"Ratio Ssim",min:0,max:10,defaultVal:R.ratioSsim,step:1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{ratioSsim:e}))}}),Object(b.jsx)(O,{id:"ga-pixldiff-ratio",name:"ga-pixldiff-ration",label:"Ratio Pixel",min:0,max:10,defaultVal:R.ratioPixelDiff,step:1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{ratioPixelDiff:e}))}})]}),Object(b.jsxs)("div",{children:[Object(b.jsx)("label",{className:"gaconfiguration-one",htmlFor:"ga-transparency",children:"Transparency:"}),Object(b.jsx)("input",{className:"gaconfiguration-three",type:"checkbox",id:"ga-transparency",value:"transparency",checked:R.enableTransparency,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{enableTransparency:e.target.checked}))}})]}),Object(b.jsx)(O,{id:"ga-vertex",name:"ga-vertex",label:"Vertex",min:3,max:10,defaultVal:R.nbVertex,step:1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{nbVertex:e}))}}),Object(b.jsx)(O,{id:"ga-vertices",name:"ga-vertices",label:"Vertices",min:50,max:500,defaultVal:R.nbPolygons,step:1,onChange:function(e){return y(Object(l.a)(Object(l.a)({},R),{},{nbPolygons:e}))}})]})}var v=function(){var e=Object(a.useState)({population:0,selectCutoff:0,keepPreviousRatio:0,newIndividualRatio:0,crossoverParentRatio:0,mutationRate:0,vertexMovement:0,colorModificationRate:0,enableSsim:!0,enablePixelDiff:!0,ratioSsim:0,ratioPixelDiff:0,enableTransparency:!0,nbVertex:0,nbPolygons:0}),t=Object(c.a)(e,2),n=t[0],i=t[1],o=Object(a.useState)({isRunning:!1,best:{genes:[],fitness:0,ssim:0,pixelDiff:0,diff:void 0,id:0,probability:0,phenotype:[]},population:[],generation:0,elapsedTime:0,notImprovingSince:0}),r=Object(c.a)(o,2),l=r[0],u=r[1],d=Object(a.useState)(""),O=Object(c.a)(d,2),v=O[0],w=O[1],C=Object(a.useState)({image:null,renderedWidth:0,renderedHeight:0,ratioOffscreenWidth:0,ratioOffscreenHeight:0,offscreenWidth:0,offscreenHeight:0,limitOffscreen:0}),S=Object(c.a)(C,2),R=S[0],y=S[1],P=Object(a.useState)(null),k=Object(c.a)(P,2),N=k[0],I=k[1],D=Object(a.useState)(!0),V=Object(c.a)(D,2),M=V[0],_=V[1],T=Object(a.useCallback)((function(e){w(e)}),[]),W=Object(a.useCallback)((function(){_(!0),w(""),N&&(N.terminate(),u({isRunning:!1,best:{genes:[],fitness:0,ssim:0,pixelDiff:0,diff:void 0,id:0,probability:0,phenotype:[]},population:[],generation:0,elapsedTime:0,notImprovingSince:0}))}),[N]),H=Object(a.useCallback)((function(e,t,n){var a=f(e.width,e.height,64),i=a.width/t,o=a.height/n,r=new OffscreenCanvas(a.width,a.height).getContext("2d");if(r){r.scale(i,o),r.drawImage(e,0,0,t,n);var c=r.getImageData(0,0,a.width,a.height);y({image:c,renderedWidth:t,renderedHeight:n,offscreenWidth:a.width,offscreenHeight:a.height,ratioOffscreenWidth:i,ratioOffscreenHeight:o,limitOffscreen:64}),I(new s),_(!1)}else console.error("ctx from url image for resizing could not be created")}),[]),E=Object(a.useCallback)((function(){_(!0)}),[]),F=Object(a.useCallback)((function(e){if(N&&R.image){var t={isRunning:l.isRunning,image:R.image,configuration:n,notImprovingSince:l.notImprovingSince,best:l.best,population:l.population,generation:l.generation,renderingHeight:R.offscreenHeight,renderingWidth:R.offscreenWidth};N.postMessage(t)}}),[l,R,N,n]),L=Object(a.useCallback)((function(e){i(e)}),[]);return Object(a.useEffect)((function(){N&&N.addEventListener("message",(function(e){var t=e.data;u(t)}))}),[N]),Object(b.jsxs)("div",{className:"wrapper",children:[Object(b.jsx)(m,{className:"one",links:[{name:"Einstein",link:"https://raw.githubusercontent.com/obartra/ssim/master/spec/samples/einstein/Q1.gif"},{name:"Joconde",link:"https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/Mona_Lisa%2C_by_Leonardo_da_Vinci%2C_from_C2RMF_retouched.jpg/390px-Mona_Lisa%2C_by_Leonardo_da_Vinci%2C_from_C2RMF_retouched.jpg"},{name:"Photographe",link:"https://i.picsum.photos/id/823/420/560.jpg?hmac=H6lJE4fRi96MxgWYyd3_79WbmObu-jJj7Zo40p5I-nU"}],start:T,stop:W,isStopped:M}),v&&Object(b.jsx)(g,{className:"two",classNameOnError:"twoExpanded",name:"original-image",onImageDrawn:H,onLoadingError:E,limit:256,url:v}),R.image&&!M&&Object(b.jsx)(j,{className:"three",onImageDrawn:F,name:"generated-image",width:R.renderedWidth,height:R.renderedHeight,ratioW:1/R.ratioOffscreenWidth,ratioH:1/R.ratioOffscreenHeight,drawingSteps:l.best.phenotype}),l.best.diff&&!M&&Object(b.jsx)(h,{className:"four",name:"diff-image",width:R.renderedWidth,height:R.renderedHeight,ratioW:1/R.ratioOffscreenWidth,ratioH:1/R.ratioOffscreenHeight,data:l.best.diff}),!M&&Object(b.jsx)(p,{className:"five",generation:l.generation,fitness:l.best.fitness,ssim:l.best.ssim,pixelDiff:l.best.pixelDiff,idBest:l.best.id,elapsedTimeForGeneration:l.elapsedTime,notImprovingSince:l.notImprovingSince}),M&&Object(b.jsx)(x,{population:50,selectCutoff:.2,keepPreviousRatio:.1,newIndividualRatio:.1,crossoverParentRatio:.5,mutationRate:.1,vertexMovement:.1,colorModificationRate:.1,enableSsim:!0,enablePixelDiff:!0,ratioSsim:3,ratioPixelDiff:1,enableTransparency:!0,nbVertex:3,nbPolygons:125,className:"five",onValuesChange:L})]})},w=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),a(e),i(e),o(e),r(e)}))};r.a.render(Object(b.jsx)(i.a.StrictMode,{children:Object(b.jsx)(v,{})}),document.getElementById("root")),w()}],[[20,1,2]]]);
//# sourceMappingURL=main.e40d008d.chunk.js.map