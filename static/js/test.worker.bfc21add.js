!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/react_ag_image/",n(n.s=8)}([function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},function(e,t,n){self,e.exports=function(){"use strict";var e={132:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.bezkrovnySsim=void 0;var r=n(490),i=n(971);function a(e,t,n){var i=e.data,a=t.data,o=n.bitDepth,d=n.k1,f=n.k2,h=Math.pow(2,o)-1,u=Math.pow(d*h,2),s=Math.pow(f*h,2),l=r.average(i),g=r.average(a),c=r.variance(i,l),v=r.variance(a,g);return(2*l*g+u)*(2*r.covariance(i,a,l,g)+s)/((Math.pow(l,2)+Math.pow(g,2)+u)*(c+v+s))}t.bezkrovnySsim=function(e,t,n){for(var r=n.windowSize,o=Math.ceil(e.width/r),d=Math.ceil(e.height/r),f=new Array(o*d),h=0,u=0;u<e.height;u+=r)for(var s=0;s<e.width;s+=r){var l=Math.min(r,e.width-s),g=Math.min(r,e.height-u),c=i.sub(e,s,g,u,l),v=i.sub(t,s,g,u,l);f[h++]=a(c,v,n)}return{data:f,width:o,height:d}}},63:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaults=void 0,t.defaults={windowSize:11,k1:.01,k2:.03,bitDepth:8,downsample:"original",ssim:"weber",maxSize:256,rgb2grayVersion:"integer"}},441:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.downsample=void 0;var r=n(490),i=n(971);function a(e,t,n){var r=i.imfilter(e,t,"symmetric","same");return i.skip2d(r,[0,n,r.height],[0,n,r.width])}t.downsample=function(e,t){return"original"===t.downsample?function(e,t,n){void 0===n&&(n=256);var o=Math.min(e.width,t.height)/n,d=Math.round(o);if(d>1){var f=i.ones(d);e=a(e,f=r.divide2d(f,r.sum2d(f)),d),t=a(t,f,d)}return[e,t]}(e[0],e[1],t.maxSize):e}},607:function(e,t,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ssim=t.getOptions=void 0;var i=n(971),a=n(490),o=n(773),d=n(595),f=n(132),h=n(441),u=n(63),s=n(535),l={fast:o.ssim,original:d.originalSsim,bezkrovny:f.bezkrovnySsim,weber:s.weberSsim};function g(e){var t=r(r({},u.defaults),e);return function(e){if(Object.keys(e).forEach((function(e){if(!(e in u.defaults))throw new Error('"'+e+'" is not a valid option')})),"k1"in e&&("number"!=typeof e.k1||e.k1<0))throw new Error("Invalid k1 value. Default is "+u.defaults.k1);if("k2"in e&&("number"!=typeof e.k2||e.k2<0))throw new Error("Invalid k2 value. Default is "+u.defaults.k2);if(!(e.ssim in l))throw new Error("Invalid ssim option (use: "+Object.keys(l).join(", ")+")")}(t),t}function c(e,t,n){var r,o,d,f,u=(new Date).getTime(),s=function(e){var t=e[0],n=e[1],r=e[2];return l[r.ssim](t,n,r)}(function(e){var t=e[0],n=e[1],r=e[2],i=h.downsample([t,n],r);return[i[0],i[1],r]}((o=(r=function(e){var t=e[0],n=e[1],r=e[2];if(t.width!==n.width||t.height!==n.height)throw new Error("Image dimensions do not match");return[t,n,r]}([e,t,g(n)]))[0],d=r[1],"original"===(f=r[2]).rgb2grayVersion?[i.rgb2gray(o),i.rgb2gray(d),f]:[i.rgb2grayInteger(o),i.rgb2grayInteger(d),f])));return{mssim:void 0!==s.mssim?s.mssim:a.mean2d(s),ssim_map:s,performance:(new Date).getTime()-u}}t.getOptions=g,t.ssim=c,t.default=c},490:function(e,t){function n(e){return r(e)/e.length}function r(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function i(e){for(var t=e.data,n=0,r=0;r<t.length;r++)n+=t[r];return n}function a(e,t){for(var n=e.data,r=e.width,i=e.height,a=new Array(n.length),o=0;o<n.length;o++)a[o]=n[o]+t;return{data:a,width:r,height:i}}function o(e,t){return"number"==typeof t?function(e,t){for(var n=e.data,r=e.width,i=e.height,a=new Array(n.length),o=0;o<n.length;o++)a[o]=n[o]*t;return{data:a,width:r,height:i}}(e,t):function(e,t){for(var n=e.data,r=e.width,i=e.height,a=t.data,o=new Array(n.length),d=0;d<n.length;d++)o[d]=n[d]*a[d];return{data:o,width:r,height:i}}(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.covariance=t.variance=t.mean2d=t.square2d=t.multiply2d=t.divide2d=t.subtract2d=t.add2d=t.sum2d=t.floor=t.sum=t.average=void 0,t.average=n,t.sum=r,t.floor=function(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=Math.floor(e[n]);return t},t.sum2d=i,t.add2d=function(e,t){return"number"==typeof t?a(e,t):function(e,t){for(var n=e.data,r=e.width,i=e.height,a=t.data,o=new Array(n.length),d=0;d<i;d++)for(var f=d*r,h=0;h<r;h++)o[f+h]=n[f+h]+a[f+h];return{data:o,width:r,height:i}}(e,t)},t.subtract2d=function(e,t){return"number"==typeof t?a(e,-t):function(e,t){for(var n=e.data,r=e.width,i=e.height,a=t.data,o=new Array(n.length),d=0;d<i;d++)for(var f=d*r,h=0;h<r;h++)o[f+h]=n[f+h]-a[f+h];return{data:o,width:r,height:i}}(e,t)},t.divide2d=function(e,t){return"number"==typeof t?function(e,t){for(var n=e.data,r=e.width,i=e.height,a=new Array(n.length),o=0;o<n.length;o++)a[o]=n[o]/t;return{data:a,width:r,height:i}}(e,t):function(e,t){for(var n=e.data,r=e.width,i=e.height,a=t.data,o=new Array(n.length),d=0;d<n.length;d++)o[d]=n[d]/a[d];return{data:o,width:r,height:i}}(e,t)},t.multiply2d=o,t.square2d=function(e){return o(e,e)},t.mean2d=function(e){return i(e)/e.data.length},t.variance=function(e,t){void 0===t&&(t=n(e));for(var r=0,i=e.length;i--;)r+=Math.pow(e[i]-t,2);return r/e.length},t.covariance=function(e,t,r,i){void 0===r&&(r=n(e)),void 0===i&&(i=n(t));for(var a=0,o=e.length;o--;)a+=(e[o]-r)*(t[o]-i);return a/e.length}},687:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.conv2=void 0;var r=n(490),i=n(298),a=n(118),o=n(799);function d(e,t,n){var r=e.data,i=e.width,a=e.height;void 0===n&&(n="full");for(var d=i+t.width-1,f=a+t.height-1,h=o.zeros(f,d).data,u=0;u<t.height;u++)for(var l=0;l<t.width;l++){var g=t.data[u*t.width+l];if(g)for(var c=0;c<a;c++)for(var v=0;v<i;v++)h[(c+u)*d+v+l]+=r[c*i+v]*g}return s({data:h,width:d,height:f},n,a,t.height,i,t.width)}function f(e,t,n){var a=t.data,o=t.width,d=t.height;void 0===n&&(n="full");var f=u(e,i.ones(d,1),i.ones(1,o),n);return r.multiply2d(f,a[0])}function h(e){for(var t=e.data,n=t[0],r=1;r<t.length;r++)if(t[r]!==n)return!1;return!0}function u(e,t,n,r){void 0===r&&(r="full");var i=Math.max(t.height,t.width),a=Math.max(n.height,n.width),o=d(e,t,"full");return s(d(o,n,"full"),r,e.height,i,e.width,a)}function s(e,t,n,r,i,o){if("full"===t)return e;if("same"===t){var d=Math.ceil((e.height-n)/2),f=Math.ceil((e.width-i)/2);return a.sub(e,d,n,f,i)}return a.sub(e,r-1,n-r+1,o-1,i-o+1)}t.conv2=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e[2]&&e[2].data?u.apply(void 0,e):h(e[1])?f.apply(void 0,e):d.apply(void 0,e)}},346:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.filter2=void 0;var r=n(687);t.filter2=function(e,t,n){return void 0===n&&(n="same"),r.conv2(t,function(e){for(var t=e.data,n=e.width,r=e.height,i=new Array(t.length),a=0;a<r;a++)for(var o=0;o<n;o++)i[a*n+o]=t[(r-1-a)*n+n-1-o];return{data:i,width:n,height:r}}(e),n)}},470:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.fspecial=void 0;var r=n(490);t.fspecial=function(e,t,n){void 0===t&&(t=3),void 0===n&&(n=1.5);var i=function(e,t){for(var n=e.data,r=e.width,i=e.height,a=new Array(n.length),o=0;o<n.length;o++)a[o]=Math.exp(-n[o]/(2*Math.pow(t,2)));return{data:a,width:r,height:i}}(function(e){for(var t=2*e+1,n=new Array(Math.pow(t,2)),r=0;r<t;r++)for(var i=0;i<t;i++)n[r*t+i]=Math.pow(r-e,2)+Math.pow(i-e,2);return{data:n,width:t,height:t}}(t=(t-1)/2),n),a=r.sum2d(i);return r.divide2d(i,a)}},521:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.imfilter=void 0;var r=n(20),i=n(389),a=n(490),o=n(346);t.imfilter=function(e,t,n,d){return void 0===n&&(n="symmetric"),void 0===d&&(d="same"),e=function(e,t,n,o){if(e=i.padarray(e,a.floor([t/2,n/2]),o),0===r.mod(t,2)&&(e.data=e.data.slice(0,-e.width),e.height--),0===r.mod(n,2)){for(var d=[],f=0;f<e.data.length;f++)(f+1)%e.width!=0&&d.push(e.data[f]);e.data=d,e.width--}return e}(e,t.width,t.height,n),d=function(e){return"same"===e&&(e="valid"),e}(d),o.filter2(t,e,d)}},971:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(687),t),i(n(346),t),i(n(470),t),i(n(521),t),i(n(150),t),i(n(298),t),i(n(389),t),i(n(582),t),i(n(439),t),i(n(118),t),i(n(240),t),i(n(799),t)},928:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.numbers=void 0,t.numbers=function(e,t,n){for(var r=t*e,i=new Array(r),a=0;a<r;a++)i[a]=n;return{data:i,width:t,height:e}}},20:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mod=void 0,t.mod=function(e,t){return e-t*Math.floor(e/t)}},150:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.normpdf=void 0,t.normpdf=function(e,t,n){var r=e.data,i=e.width,a=e.height;void 0===t&&(t=0),void 0===n&&(n=1);for(var o=new Array(r.length),d=0;d<r.length;d++){var f=(r[d]-t)/n;o[d]=Math.exp(-Math.pow(f,2)/2)/(2.5066282746310007*n)}return{data:o,width:i,height:a}}},298:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ones=void 0;var r=n(928);t.ones=function(e,t){return void 0===t&&(t=e),r.numbers(e,t,1)}},389:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.padarray=void 0;var r=n(20);t.padarray=function(e,t,n,i){var a=t[0],o=t[1];return e.height>=a&&e.width>=o?function(e,t){for(var n=t[0],r=t[1],i=e.width+2*r,a=e.height+2*n,o=new Array(i*a),d=-n;d<0;d++){for(var f=-r;f<0;f++)o[(d+n)*i+f+r]=e.data[(Math.abs(d)-1)*e.width+Math.abs(f)-1];for(f=0;f<e.width;f++)o[(d+n)*i+f+r]=e.data[(Math.abs(d)-1)*e.width+f];for(f=e.width;f<e.width+r;f++)o[(d+n)*i+f+r]=e.data[(Math.abs(d)-1)*e.width+2*e.width-f-1]}for(d=0;d<e.height;d++){for(f=-r;f<0;f++)o[(d+n)*i+f+r]=e.data[d*e.width+Math.abs(f)-1];for(f=0;f<e.width;f++)o[(d+n)*i+f+r]=e.data[d*e.width+f];for(f=e.width;f<e.width+r;f++)o[(d+n)*i+f+r]=e.data[d*e.width+2*e.width-f-1]}for(d=e.height;d<e.height+n;d++){for(f=-r;f<0;f++)o[(d+n)*i+f+r]=e.data[(2*e.height-d-1)*e.width+Math.abs(f)-1];for(f=0;f<e.width;f++)o[(d+n)*i+f+r]=e.data[(2*e.height-d-1)*e.width+f];for(f=e.width;f<e.width+r;f++)o[(d+n)*i+f+r]=e.data[(2*e.height-d-1)*e.width+2*e.width-f-1]}return{data:o,width:i,height:a}}(e,[a,o]):function(e,t){for(var n=function(e,t){return{data:e.data.concat(t.data),height:e.height+t.height,width:e.width}}(e,function(e){for(var t=e.data,n=e.width,r=e.height,i=new Array(t.length),a=0;a<r;a++)for(var o=0;o<n;o++)i[a*n+o]=t[(r-1-a)*n+o];return{data:i,width:n,height:r}}(e)),i=e.height+2*t,a=new Array(e.width*i),o=-t;o<e.height+t;o++)for(var d=0;d<e.width;d++)a[(o+t)*e.width+d]=n.data[r.mod(o,n.height)*e.width+d];return{data:a,width:e.width,height:i}}(function(e,t){for(var n=e.width+2*t,i=new Array(n*e.height),a=function(e,t){for(var n=e.width+t.width,r=new Array(e.height*n),i=0;i<e.height;i++){for(var a=0;a<e.width;a++)r[i*n+a]=e.data[i*e.width+a];for(a=0;a<t.width;a++)r[i*n+a+e.width]=t.data[i*t.width+a]}return{data:r,width:n,height:e.height}}(e,function(e){for(var t=e.data,n=e.width,r=e.height,i=new Array(t.length),a=0;a<r;a++)for(var o=0;o<n;o++)i[a*n+o]=t[a*n+n-1-o];return{data:i,width:n,height:r}}(e)),o=0;o<e.height;o++)for(var d=-t;d<e.width+t;d++)i[o*n+d+t]=a.data[o*a.width+r.mod(d,a.width)];return{data:i,width:n,height:e.height}}(e,o),a)}},582:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.rgb2grayInteger=t.rgb2gray=void 0,t.rgb2gray=function(e){for(var t=e.data,n=e.width,r=e.height,i=new Uint8Array(n*r),a=0;a<t.length;a+=4)i[a/4]=.29894*t[a]+.58704*t[a+1]+.11402*t[a+2]+.5;return{data:Array.from(i),width:n,height:r}},t.rgb2grayInteger=function(e){for(var t=e.data,n=e.width,r=e.height,i=new Array(n*r),a=0;a<t.length;a+=4)i[a/4]=77*t[a]+150*t[a+1]+29*t[a+2]+128>>8;return{data:i,width:n,height:r}}},439:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.skip2d=void 0,t.skip2d=function(e,t,n){for(var r=t[0],i=t[1],a=t[2],o=n[0],d=n[1],f=n[2],h=Math.ceil((f-o)/d),u=Math.ceil((a-r)/i),s=new Array(h*u),l=0;l<u;l++)for(var g=0;g<h;g++){var c=r+l*i,v=o+g*d;s[l*h+g]=e.data[c*e.width+v]}return{data:s,width:h,height:u}}},118:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.sub=void 0,t.sub=function(e,t,n,r,i){for(var a=e.data,o=e.width,d=new Array(i*n),f=0;f<n;f++)for(var h=0;h<i;h++)d[f*i+h]=a[(r+f)*o+t+h];return{data:d,width:i,height:n}}},240:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.transpose=void 0,t.transpose=function(e){for(var t=e.data,n=e.width,r=e.height,i=new Array(n*r),a=0;a<r;a++)for(var o=0;o<n;o++)i[o*r+a]=t[a*n+o];return{data:i,height:n,width:r}}},799:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.zeros=void 0;var r=n(928);t.zeros=function(e,t){return void 0===t&&(t=e),r.numbers(e,t,0)}},595:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.originalSsim=void 0;var r=n(490),i=n(971);t.originalSsim=function(e,t,n){var a=i.fspecial("gaussian",n.windowSize,1.5),o=Math.pow(2,n.bitDepth)-1,d=Math.pow(n.k1*o,2),f=Math.pow(n.k2*o,2);a=r.divide2d(a,r.sum2d(a));var h=i.filter2(a,e,"valid"),u=i.filter2(a,t,"valid"),s=r.square2d(h),l=r.square2d(u),g=r.multiply2d(h,u),c=r.square2d(e),v=r.square2d(t),p=r.subtract2d(i.filter2(a,c,"valid"),s),w=r.subtract2d(i.filter2(a,v,"valid"),l),m=r.subtract2d(i.filter2(a,r.multiply2d(e,t),"valid"),g);if(d>0&&f>0){var y=r.add2d(r.multiply2d(g,2),d),b=r.add2d(r.multiply2d(m,2),f),M=r.add2d(r.add2d(s,l),d),x=r.add2d(r.add2d(p,w),f);return r.divide2d(r.multiply2d(y,b),r.multiply2d(M,x))}var P=r.multiply2d(g,2),S=r.multiply2d(m,2),_=r.add2d(s,l),A=r.add2d(p,w);return r.divide2d(r.multiply2d(P,S),r.multiply2d(_,A))}},773:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ssim=void 0;var r=n(490),i=n(971);t.ssim=function(e,t,n){var a=i.normpdf(function(e){for(var t=Math.floor(e/2),n=new Array(2*t+1),r=-t;r<=t;r++)n[r+t]=Math.abs(r);return{data:n,width:n.length,height:1}}(n.windowSize),0,1.5),o=Math.pow(2,n.bitDepth)-1,d=Math.pow(n.k1*o,2),f=Math.pow(n.k2*o,2);a=r.divide2d(a,r.sum2d(a));var h=i.transpose(a),u=i.conv2(e,a,h,"valid"),s=i.conv2(t,a,h,"valid"),l=r.square2d(u),g=r.square2d(s),c=r.multiply2d(u,s),v=r.square2d(e),p=r.square2d(t),w=r.subtract2d(i.conv2(v,a,h,"valid"),l),m=r.subtract2d(i.conv2(p,a,h,"valid"),g),y=r.subtract2d(i.conv2(r.multiply2d(e,t),a,h,"valid"),c);return d>0&&f>0?function(e,t,n,i,a,o,d,f){var h=r.add2d(r.multiply2d(e,2),d),u=r.add2d(r.multiply2d(t,2),f),s=r.add2d(r.add2d(n,i),d),l=r.add2d(r.add2d(a,o),f);return r.divide2d(r.multiply2d(h,u),r.multiply2d(s,l))}(c,y,l,g,w,m,d,f):function(e,t,n,i,a,o){var d=r.multiply2d(e,2),f=r.multiply2d(t,2),h=r.add2d(n,i),u=r.add2d(a,o);return r.divide2d(r.multiply2d(d,f),r.multiply2d(h,u))}(c,y,l,g,w,m)}},535:function(e,t){var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(e,t,n,r){return{rightEdge:n[t*r+e+1],bottomEdge:n[(t+1)*r+e],bottomRightEdge:n[(t+1)*r+e+1]}}function i(e,t){for(var n=e.width,i=e.height,a=e.data,o=n+1,d=i+1,f=new Int32Array(o*d),h=i-1;h>=0;--h)for(var u=n-1;u>=0;--u){var s=r(u,h,f,o),l=s.rightEdge,g=s.bottomEdge,c=s.bottomRightEdge;f[h*o+u]=t(a[h*n+u],u,h)+l+g-c}return{data:f,height:d,width:o}}function a(e,t,n){for(var i=e.width,a=e.height,o=e.data,d=t.data,f=i+1,h=a+1,u=new Int32Array(f*h),s=a-1;s>=0;--s)for(var l=i-1;l>=0;--l){var g=r(l,s,u,f),c=g.rightEdge,v=g.bottomEdge,p=g.bottomRightEdge,w=s*i+l;u[s*f+l]=n(o[w],d[w],l,s)+c+v-p}return{data:u,height:h,width:f}}function o(e,t,n){for(var r=e.width,i=e.height,a=e.data,o=r-1,d=i-1,f=o-t+1,h=d-t+1,u=new Int32Array(f*h),s=0;s<d;++s)for(var l=0;l<o;++l)if(l<f&&s<h){var g=a[r*s+l]-a[r*s+l+t]-a[r*(s+t)+l]+a[r*(s+t)+l+t];u[s*f+l]=g/n}return{height:h,width:f,data:u}}function d(e,t){return o(i(e,(function(e){return e})),t,1)}function f(e,t,n){for(var r=n*n,a=o(i(e,(function(e){return e*e})),n,1),d=0;d<t.data.length;++d){var f=t.data[d]/r,h=a.data[d]/r,u=f*f;a.data[d]=1024*(h-u)}return a}function h(e,t,n,r,i){for(var d=i*i,f=o(a(e,t,(function(e,t){return e*t})),i,1),h=0;h<n.data.length;++h)f.data[h]=1024*(f.data[h]/d-n.data[h]/d*(r.data[h]/d));return f}Object.defineProperty(t,"__esModule",{value:!0}),t.weberSsim=t.windowCovariance=t.windowVariance=t.windowSums=t.windowMatrix=t.partialSumMatrix2=t.partialSumMatrix1=void 0,t.partialSumMatrix1=i,t.partialSumMatrix2=a,t.windowMatrix=o,t.windowSums=d,t.windowVariance=f,t.windowCovariance=h,t.weberSsim=function(e,t,r){for(var i=r.bitDepth,a=r.k1,o=r.k2,u=r.windowSize,s=Math.pow(2,i)-1,l=a*s*(a*s),g=o*s*(o*s),c=u*u,v=n(n({},e),{data:Int32Array.from(e.data,(function(e){return e+.5}))}),p=n(n({},t),{data:Int32Array.from(t.data,(function(e){return e+.5}))}),w=d(v,u),m=f(v,w,u),y=d(p,u),b=f(p,y,u),M=h(v,p,w,y,u),x=w.data.length,P=0,S=new Array(x),_=0;_<x;++_){var A=w.data[_]/c,O=y.data[_]/c,D=m.data[_]/1024,j=b.data[_]/1024,k=(2*A*O+l)*(M.data[_]/1024*2+g)/(A*A+O*O+l)/(D+j+g);S[_]=k,0==_?P=k:P+=(k-P)/(_+1)}return{data:S,width:w.width,height:w.height,mssim:P}}}},t={};return function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(607)}()},function(e,t,n){"use strict";var r=n(3);e.exports=function(e,t,n,d,h,u){if(!a(e)||!a(t)||n&&!a(n))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(e.length!==t.length||n&&n.length!==e.length)throw new Error("Image sizes do not match.");if(e.length!==d*h*4)throw new Error("Image data size does not match width/height.");u=Object.assign({},i,u);for(var s=d*h,l=new Uint32Array(e.buffer,e.byteOffset,s),v=new Uint32Array(t.buffer,t.byteOffset,s),p=!0,w=0;w<s;w++)if(l[w]!==v[w]){p=!1;break}if(p){if(n&&!u.diffMask)for(var m=0;m<s;m++)c(e,4*m,u.alpha,n);return 0}for(var y=35215*u.threshold*u.threshold,b=0,M=0;M<h;M++)for(var x=0;x<d;x++){var P=4*(M*d+x),S=f(e,t,P,P);Math.abs(S)>y?u.includeAA||!o(e,x,M,d,h,t)&&!o(t,x,M,d,h,e)?(n&&g.apply(void 0,[n,P].concat(r(S<0&&u.diffColorAlt||u.diffColor))),b++):n&&!u.diffMask&&g.apply(void 0,[n,P].concat(r(u.aaColor))):n&&(u.diffMask||c(e,P,u.alpha,n))}return b};var i={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffColorAlt:null,diffMask:!1};function a(e){return ArrayBuffer.isView(e)&&1===e.constructor.BYTES_PER_ELEMENT}function o(e,t,n,r,i,a){for(var o,h,u,s,l=Math.max(t-1,0),g=Math.max(n-1,0),c=Math.min(t+1,r-1),v=Math.min(n+1,i-1),p=4*(n*r+t),w=t===l||t===c||n===g||n===v?1:0,m=0,y=0,b=l;b<=c;b++)for(var M=g;M<=v;M++)if(b!==t||M!==n){var x=f(e,e,p,4*(M*r+b),!0);if(0===x){if(++w>2)return!1}else x<m?(m=x,o=b,h=M):x>y&&(y=x,u=b,s=M)}return 0!==m&&0!==y&&(d(e,o,h,r,i)&&d(a,o,h,r,i)||d(e,u,s,r,i)&&d(a,u,s,r,i))}function d(e,t,n,r,i){for(var a=Math.max(t-1,0),o=Math.max(n-1,0),d=Math.min(t+1,r-1),f=Math.min(n+1,i-1),h=4*(n*r+t),u=t===a||t===d||n===o||n===f?1:0,s=a;s<=d;s++)for(var l=o;l<=f;l++)if(s!==t||l!==n){var g=4*(l*r+s);if(e[h]===e[g]&&e[h+1]===e[g+1]&&e[h+2]===e[g+2]&&e[h+3]===e[g+3]&&u++,u>2)return!0}return!1}function f(e,t,n,r,i){var a=e[n+0],o=e[n+1],d=e[n+2],f=e[n+3],g=t[r+0],c=t[r+1],v=t[r+2],p=t[r+3];if(f===p&&a===g&&o===c&&d===v)return 0;f<255&&(a=l(a,f/=255),o=l(o,f),d=l(d,f)),p<255&&(g=l(g,p/=255),c=l(c,p),v=l(v,p));var w=h(a,o,d),m=h(g,c,v),y=w-m;if(i)return y;var b=u(a,o,d)-u(g,c,v),M=s(a,o,d)-s(g,c,v),x=.5053*y*y+.299*b*b+.1957*M*M;return w>m?-x:x}function h(e,t,n){return.29889531*e+.58662247*t+.11448223*n}function u(e,t,n){return.59597799*e-.2741761*t-.32180189*n}function s(e,t,n){return.21147017*e-.52261711*t+.31114694*n}function l(e,t){return 255+(e-255)*t}function g(e,t,n,r,i){e[t+0]=n,e[t+1]=r,e[t+2]=i,e[t+3]=255}function c(e,t,n,r){var i=l(h(e[t+0],e[t+1],e[t+2]),n*e[t+3]/255);g(r,t,i,i,i)}},function(e,t,n){var r=n(4),i=n(5),a=n(6),o=n(7);e.exports=function(e){return r(e)||i(e)||a(e)||o()}},function(e,t,n){var r=n(0);e.exports=function(e){if(Array.isArray(e))return r(e)}},function(e,t){e.exports=function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},function(e,t,n){var r=n(0);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function a(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.r(t);var o=n(1),d=n.n(o),f=n(2),h=n.n(f);function u(e){return 3===e.length?"rgb(".concat(e[0],",").concat(e[1],",").concat(e[2],")"):"rgba(".concat(e[0],",").concat(e[1],",").concat(e[2],",").concat(e[3],")")}function s(e,t){if(e&&0!==t.vertices.length){e.fillStyle=u(t.color),e.beginPath();var n=t.vertices[0];e.moveTo(n.x,n.y);for(var r=1;r<t.vertices.length;r++)n=t.vertices[r],e.lineTo(n.x,n.y);e.closePath(),e.fill()}}function l(e,t,n,r){var i=2*Math.random()*Math.PI,a=Math.random()*t,o=e.x+Math.floor(Math.cos(i)*a);o=Math.max(0,Math.min(o,n));var d=e.y+Math.floor(Math.sin(i)*a);return{x:o,y:d=Math.max(0,Math.min(d,r))}}function g(e,t,n,r){for(var i=[],a=n/2,o=r/2,d=v(0,n,!0),f=v(0,r,!0),h=0;h<e;h++){var u=d+v(-a,a,!0);u=Math.max(0,Math.min(u,n));var s=f+v(-o,o,!0);s=Math.max(0,Math.min(s,r)),i.push(u),i.push(s)}for(var l=0;l<t;l++){var g=l<3?v(0,256,!0):v(.2,1,!1);i.push(g)}return i}function c(e,t,n,r,i){for(var a=[],o=0;o<e;o++){var d=g(t,n,r,i);a=a.concat(d)}return{id:Date.now(),genes:a,fitness:0,ssim:0,pixelDiff:0,subPixel:0,polygon:0,diff:void 0,probability:0,phenotype:[]}}function v(e,t,n){var r=Math.random()*(t-e)+e;return r=n?Math.floor(r):Math.round(1e3*r)/1e3}function p(e){var t,n=0,r=[],o=a(e),d=function(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,d=!0,f=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return d=e.done,e},e:function(e){f=!0,o=e},f:function(){try{d||null==n.return||n.return()}finally{if(f)throw o}}}}(e);try{for(d.s();!(t=d.n()).done;){var f=t.value,h=f.fitness*f.fitness;r.push(h),n+=h}}catch(l){d.e(l)}finally{d.f()}for(var u=0,s=0;s<r.length;s++){u+=r[s]/n,o[s].probability=u}return o[o.length-1].probability=1,o}function w(e){for(var t=Math.random(),n=0;n<e.length&&e[n].probability<=t;)n++;return n===e.length&&(n-=1),e[n]}function m(e,t){for(var n={id:0,genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,polygon:0,diff:void 0,probability:0,phenotype:[]},r=0;r<t;r++){var i=e[Math.floor(Math.random()*e.length)];(0===n.id||i.fitness>n.fitness)&&(n=i)}return n}function y(e,t,n,r,i,a){switch(n){case"polygon":return function(e,t,n,r,i){var a={genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,polygon:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},o=e.fitness>t.fitness?n:1-n,d=0,f=e.fitness>t.fitness?e.genes.length:t.genes.length,h=2*r+i;for(;d<f;)Math.random()<o&&d<e.genes.length?a.genes=a.genes.concat(e.genes.slice(d,d+h)):d<t.genes.length?a.genes=a.genes.concat(t.genes.slice(d,d+h)):a.genes=a.genes.concat(e.genes.slice(d,d+h)),d+=h;return a}(e,t,r,i,a);case"vertex":return function(e,t,n,r,i){var a={genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,polygon:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},o=e.fitness>t.fitness?n:1-n,d=0;for(;d<e.genes.length;){if(d%(2*r+i)<2*r){var f=void 0,h={x:(f=Math.random()<o&&d<e.genes.length?e.genes:d<t.genes.length?t.genes:e.genes)[d],y:f[d+1]};a.genes.push(h.x),a.genes.push(h.y),d+=2}else{var u=void 0;u=Math.random()<o&&d<e.genes.length-i?e.genes:d<t.genes.length-i?t.genes:e.genes,a.genes.push(u[d]),a.genes.push(u[d+1]),a.genes.push(u[d+2]),d+=3,4===i&&(a.genes.push(u[d]),d++)}}return a}(e,t,r,i,a);case"data":return function(e,t,n,r,i){var a={genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,polygon:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},o=e.fitness>t.fitness?n:1-n,d=0,f=e.fitness>t.fitness?e.genes.length:t.genes.length;for(;d<f;)Math.random()<o&&d<e.genes.length?a.genes.push(e.genes[d]):d<t.genes.length?a.genes.push(t.genes[d]):a.genes.push(e.genes[d]),d++;return a}(e,t,r);default:return function(e,t,n,r,i){var a={genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,polygon:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},o=2*r+i,d=e.fitness>t.fitness?e.genes:t.genes,f=e.fitness>t.fitness?t.genes:e.genes,h=Math.floor(d.length*n)*o;if(e.genes.length==t.genes.length)a.genes=a.genes.concat(d.slice(0,h)),a.genes=a.genes.concat(f.slice(h));else{a.genes=a.genes.concat(d.slice(0,h));var u=d.length-h;u>f.length?(a.genes=a.genes.concat(f),a.genes=a.genes.concat(d.slice(h,d.length-f.length))):a.genes=a.genes.concat(f.slice(f.length-u))}return a}(e,t,r,i,a)}}t.default={};function b(e,t,n,r,i,a,o,f,u,l,g,c,v){e.phenotype=function(e,t,n){for(var r=[],i=2*t+n,a=0;a<e.length;a+=i){for(var o={vertices:[],color:[]},d=2*t,f=0;f<d;f+=2){var h={x:e[a+f],y:e[a+f+1]};o.vertices.push(h)}for(var u=0;u<n;u++)o.color.push(e[a+d+u]);r.push(o)}return r}(e.genes,l,g),v.clearRect(0,0,c.width,c.height),v.fillStyle="#000000",v.fillRect(0,0,c.width,c.height);for(var p=0;p<e.phenotype.length;p++){s(v,e.phenotype[p])}var w=v.getImageData(0,0,c.width,c.height),m={mssim:0},y=a;if(t){m=d()(c,w,{rgb2grayVersion:"original",windowSize:11,k1:.01,k2:.03,bitDepth:8,downsample:"original",ssim:"weber"})}else y=0;var b=void 0,M=0,x=o;if(n){var P=new OffscreenCanvas(c.width,c.height).getContext("2d"),S=0;P&&(b=P.createImageData(c.width,c.height),S=h()(c.data,w.data,b.data,c.width,c.height,{threshold:.1})),M=(c.width*c.height-S)/(c.width*c.height)}else x=0;var _=0,A=f;if(r){for(var O=0,D=c.width*c.height*g,j=0;j<D;j++)O+=Math.abs(c.data[j]-w.data[j]);_=1-O/(c.width*c.height*g*256)}else A=0;var k=0,I=u;if(i){var E=2*l+g;k=1-e.genes.length/E/500}else I=0;return{fitness:k*I+(m.mssim*y+M*x+_*A)/(y+x+A+I),ssim:m.mssim,pixelDiff:M,subPixel:_,polygon:k,diff:b}}function M(e,t,n,r,i,a,o,d,f,h,u,s,p){for(var w={genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,polygon:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},m=p?1:t,y=0,b=2*d+f;y<e.genes.length;)if(Math.random()<m){var M=y%b,P=M%2===0&&M<2*d,S=M>=2*d,_=M===2*d,A=0===M,O=w.genes.length%b;if(P){var D=Math.random();if(h&&A&&D<a&&O<500){var j=g(d,f,u,s);w.genes=w.genes.concat(j)}else if(h&&A&&D<o)y+=b;else{var k={x:e.genes[y],y:e.genes[y+1]},I=Math.max(u,s)*n,E=v(-I,I,!1);E>-1&&E<=0&&(E=-1),E<1&&E>=0&&(E=1),k=l(k,E,u,s),w.genes.push(k.x),w.genes.push(k.y),y+=2}}else if(S)if(Math.random()<i&&_){var R=x(y-M,e.genes,d,f);w.genes=w.genes.concat(R),y+=f}else{var V=v(-r,r,!1),C=e.genes[y]+e.genes[y]*V;4===f&&M===b-1?C=Math.max(.2,Math.min(C,1)):(C=Math.round(C),C=Math.max(0,Math.min(C,255))),w.genes.push(C),y++}else w.genes.push(e.genes[y]),y++}else w.genes.push(e.genes[y]),y++;if(0===w.genes.length){var z=c(e.genes.length/b,d,f,u,s);w.genes=z.genes}return w}function x(e,t,n,r){for(var i=0,a=0,o=e+2*n,d=e;d<o;d+=2)i+=t[d],a+=t[d+1];i=Math.round(i/n),a=Math.round(a/n);for(var f=0,h=2*n+r,u=0,s=1/0;f<t.length;){if(f!==e){for(var l=0,g=0,c=f+2*n,v=f;v<c;v+=2)l+=t[v],g+=t[v+1];var p=((l=Math.round(l/n))-i)*(l-i)+((g=Math.round(g/n))-a)*(g-a);p<s&&(s=p,u=f)}f+=h}for(var w=[],m=0;m<r;m++)w.push(t[u+2*n+m]);return w}self.addEventListener("message",(function(e){if(e){var t=e.data,n=t.configuration,r=n.enableTransparency?4:3,i=t.population,o=t.best,d=t.image,f=new OffscreenCanvas(t.renderingWidth,t.renderingHeight).getContext("2d"),h=new OffscreenCanvas(t.renderingWidth,t.renderingHeight).getContext("2d");if(f&&h){h.putImageData(d,0,0);var u=h.getImageData(0,0,t.renderingWidth,t.renderingHeight),s=[],l=(new Date).getTime();if(0===i.length)s=function(e,t,n,r,i,o,d,f,h,u,s,l,g){if(!g)return a(e);for(var c=[],v=0;v<e.length;v++){var p=e[v],w=b(p,t,n,r,i,o,d,f,h,u,s,l,g),m={genes:a(p.genes),fitness:w.fitness,ssim:w.ssim,pixelDiff:w.pixelDiff,subPixel:w.subPixel,polygon:w.polygon,diff:w.diff,probability:0,id:p.id,phenotype:a(p.phenotype)};c.push(m)}return c}(s=function(e,t,n,r,i,a){for(var o=[],d=0;d<e;d++){var f=c(t,n,r,i,a);o.push(f)}return o}(n.population,n.nbPolygons,n.nbVertex,r,t.renderingWidth,t.renderingHeight),n.enableSsim,n.enablePixelDiff,n.enableSubDiff,n.enableVariablePolygons,n.ratioSsim,n.ratioPixelDiff,n.ratioSubDiff,n.ratioPolygons,n.nbVertex,r,u,f);else{o.id!==i[0].id&&(i=p([].concat(a(i),[o])));for(var g=function(e,t){for(var n=[],r=0;r<t;r++){var i=w(e);n.push(i)}return n}(i=a(i).sort((function(e,t){return e.probability-t.probability})),Math.round(i.length*n.selectCutoff)),v=0;v<n.population;v++){var x=Math.random();if(x<n.keepPreviousRatio){var P=M(w(i),n.mutationRate,n.vertexMovement,n.colorModificationRate,n.copyColorNeighborRate,n.addPolygonRate,n.removePolygonRate,n.nbVertex,r,n.enableVariablePolygons,t.renderingWidth,t.renderingHeight,!1),S=b(P,n.enableSsim,n.enablePixelDiff,n.enableSubDiff,n.enableVariablePolygons,n.ratioSsim,n.ratioPixelDiff,n.ratioSubDiff,n.ratioPolygons,n.nbVertex,r,u,f);P.fitness=S.fitness,P.ssim=S.ssim,P.pixelDiff=S.pixelDiff,P.subPixel=S.subPixel,P.polygon=S.polygon,P.diff=S.diff,s.push(P)}else if(x<n.keepPreviousRatio+n.newIndividualRatio){var _=2*n.nbVertex+r,A=c(o.genes.length/_,n.nbVertex,r,t.renderingWidth,t.renderingHeight),O=b(A,n.enableSsim,n.enablePixelDiff,n.enableSubDiff,n.enableVariablePolygons,n.ratioSsim,n.ratioPixelDiff,n.ratioSubDiff,n.ratioPolygons,n.nbVertex,r,u,f);A.fitness=O.fitness,A.ssim=O.ssim,A.pixelDiff=O.pixelDiff,A.subPixel=O.subPixel,A.polygon=O.polygon,A.diff=O.diff,s.push(A)}else{var D=void 0,j=void 0;"tournament"===n.parentSelectionStrategy?(D=m(g,n.tournamentSize),j=m(g,n.tournamentSize)):(D=w(i),j=w(i));var k=y(D,j,n.crossoverStrategy,n.crossoverParentRatio,n.nbVertex,r);0===k.genes.length&&console.log("Child has 0 genes in "+t.generation+"1 generation");var I=b(k=M(k,n.mutationRate,n.vertexMovement,n.colorModificationRate,n.copyColorNeighborRate,n.addPolygonRate,n.removePolygonRate,n.nbVertex,r,n.enableVariablePolygons,t.renderingWidth,t.renderingHeight,!1),n.enableSsim,n.enablePixelDiff,n.enableSubDiff,n.enableVariablePolygons,n.ratioSsim,n.ratioPixelDiff,n.ratioSubDiff,n.ratioPolygons,n.nbVertex,r,u,f);k.fitness=I.fitness,k.ssim=I.ssim,k.pixelDiff=I.pixelDiff,k.subPixel=I.subPixel,k.polygon=I.polygon,k.diff=I.diff,s.push(k)}}}s=function(e){return a(e).sort((function(e,t){return t.fitness-e.fitness}))}(s);var E,R=((new Date).getTime()-l)/1e3,V=t.notImprovingSince;o&&o.fitness>s[0].fitness?(E=o,V++):(E=s[0],V=0);var C={isRunning:!0,best:E,population:s,generation:t.generation+1,elapsedTime:R,notImprovingSince:V};postMessage(C)}else{console.error("no ctx to draw the image");var z={isRunning:!0,best:o,population:a(i),generation:t.generation,elapsedTime:0,notImprovingSince:0};postMessage(z)}}}))}]);
//# sourceMappingURL=test.worker.bfc21add.js.map