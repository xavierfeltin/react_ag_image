!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/react_ag_image/",r(r.s=8)}([function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}},function(t,e,r){self,t.exports=function(){"use strict";var t={132:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.bezkrovnySsim=void 0;var n=r(490),i=r(971);function a(t,e,r){var i=t.data,a=e.data,o=r.bitDepth,d=r.k1,f=r.k2,h=Math.pow(2,o)-1,u=Math.pow(d*h,2),s=Math.pow(f*h,2),l=n.average(i),c=n.average(a),v=n.variance(i,l),g=n.variance(a,c);return(2*l*c+u)*(2*n.covariance(i,a,l,c)+s)/((Math.pow(l,2)+Math.pow(c,2)+u)*(v+g+s))}e.bezkrovnySsim=function(t,e,r){for(var n=r.windowSize,o=Math.ceil(t.width/n),d=Math.ceil(t.height/n),f=new Array(o*d),h=0,u=0;u<t.height;u+=n)for(var s=0;s<t.width;s+=n){var l=Math.min(n,t.width-s),c=Math.min(n,t.height-u),v=i.sub(t,s,c,u,l),g=i.sub(e,s,c,u,l);f[h++]=a(v,g,r)}return{data:f,width:o,height:d}}},63:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.defaults=void 0,e.defaults={windowSize:11,k1:.01,k2:.03,bitDepth:8,downsample:"original",ssim:"weber",maxSize:256,rgb2grayVersion:"integer"}},441:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.downsample=void 0;var n=r(490),i=r(971);function a(t,e,r){var n=i.imfilter(t,e,"symmetric","same");return i.skip2d(n,[0,r,n.height],[0,r,n.width])}e.downsample=function(t,e){return"original"===e.downsample?function(t,e,r){void 0===r&&(r=256);var o=Math.min(t.width,e.height)/r,d=Math.round(o);if(d>1){var f=i.ones(d);t=a(t,f=n.divide2d(f,n.sum2d(f)),d),e=a(e,f,d)}return[t,e]}(t[0],t[1],e.maxSize):t}},607:function(t,e,r){var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ssim=e.getOptions=void 0;var i=r(971),a=r(490),o=r(773),d=r(595),f=r(132),h=r(441),u=r(63),s=r(535),l={fast:o.ssim,original:d.originalSsim,bezkrovny:f.bezkrovnySsim,weber:s.weberSsim};function c(t){var e=n(n({},u.defaults),t);return function(t){if(Object.keys(t).forEach((function(t){if(!(t in u.defaults))throw new Error('"'+t+'" is not a valid option')})),"k1"in t&&("number"!=typeof t.k1||t.k1<0))throw new Error("Invalid k1 value. Default is "+u.defaults.k1);if("k2"in t&&("number"!=typeof t.k2||t.k2<0))throw new Error("Invalid k2 value. Default is "+u.defaults.k2);if(!(t.ssim in l))throw new Error("Invalid ssim option (use: "+Object.keys(l).join(", ")+")")}(e),e}function v(t,e,r){var n,o,d,f,u=(new Date).getTime(),s=function(t){var e=t[0],r=t[1],n=t[2];return l[n.ssim](e,r,n)}(function(t){var e=t[0],r=t[1],n=t[2],i=h.downsample([e,r],n);return[i[0],i[1],n]}((o=(n=function(t){var e=t[0],r=t[1],n=t[2];if(e.width!==r.width||e.height!==r.height)throw new Error("Image dimensions do not match");return[e,r,n]}([t,e,c(r)]))[0],d=n[1],"original"===(f=n[2]).rgb2grayVersion?[i.rgb2gray(o),i.rgb2gray(d),f]:[i.rgb2grayInteger(o),i.rgb2grayInteger(d),f])));return{mssim:void 0!==s.mssim?s.mssim:a.mean2d(s),ssim_map:s,performance:(new Date).getTime()-u}}e.getOptions=c,e.ssim=v,e.default=v},490:function(t,e){function r(t){return n(t)/t.length}function n(t){for(var e=0,r=0;r<t.length;r++)e+=t[r];return e}function i(t){for(var e=t.data,r=0,n=0;n<e.length;n++)r+=e[n];return r}function a(t,e){for(var r=t.data,n=t.width,i=t.height,a=new Array(r.length),o=0;o<r.length;o++)a[o]=r[o]+e;return{data:a,width:n,height:i}}function o(t,e){return"number"==typeof e?function(t,e){for(var r=t.data,n=t.width,i=t.height,a=new Array(r.length),o=0;o<r.length;o++)a[o]=r[o]*e;return{data:a,width:n,height:i}}(t,e):function(t,e){for(var r=t.data,n=t.width,i=t.height,a=e.data,o=new Array(r.length),d=0;d<r.length;d++)o[d]=r[d]*a[d];return{data:o,width:n,height:i}}(t,e)}Object.defineProperty(e,"__esModule",{value:!0}),e.covariance=e.variance=e.mean2d=e.square2d=e.multiply2d=e.divide2d=e.subtract2d=e.add2d=e.sum2d=e.floor=e.sum=e.average=void 0,e.average=r,e.sum=n,e.floor=function(t){for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=Math.floor(t[r]);return e},e.sum2d=i,e.add2d=function(t,e){return"number"==typeof e?a(t,e):function(t,e){for(var r=t.data,n=t.width,i=t.height,a=e.data,o=new Array(r.length),d=0;d<i;d++)for(var f=d*n,h=0;h<n;h++)o[f+h]=r[f+h]+a[f+h];return{data:o,width:n,height:i}}(t,e)},e.subtract2d=function(t,e){return"number"==typeof e?a(t,-e):function(t,e){for(var r=t.data,n=t.width,i=t.height,a=e.data,o=new Array(r.length),d=0;d<i;d++)for(var f=d*n,h=0;h<n;h++)o[f+h]=r[f+h]-a[f+h];return{data:o,width:n,height:i}}(t,e)},e.divide2d=function(t,e){return"number"==typeof e?function(t,e){for(var r=t.data,n=t.width,i=t.height,a=new Array(r.length),o=0;o<r.length;o++)a[o]=r[o]/e;return{data:a,width:n,height:i}}(t,e):function(t,e){for(var r=t.data,n=t.width,i=t.height,a=e.data,o=new Array(r.length),d=0;d<r.length;d++)o[d]=r[d]/a[d];return{data:o,width:n,height:i}}(t,e)},e.multiply2d=o,e.square2d=function(t){return o(t,t)},e.mean2d=function(t){return i(t)/t.data.length},e.variance=function(t,e){void 0===e&&(e=r(t));for(var n=0,i=t.length;i--;)n+=Math.pow(t[i]-e,2);return n/t.length},e.covariance=function(t,e,n,i){void 0===n&&(n=r(t)),void 0===i&&(i=r(e));for(var a=0,o=t.length;o--;)a+=(t[o]-n)*(e[o]-i);return a/t.length}},687:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.conv2=void 0;var n=r(490),i=r(298),a=r(118),o=r(799);function d(t,e,r){var n=t.data,i=t.width,a=t.height;void 0===r&&(r="full");for(var d=i+e.width-1,f=a+e.height-1,h=o.zeros(f,d).data,u=0;u<e.height;u++)for(var l=0;l<e.width;l++){var c=e.data[u*e.width+l];if(c)for(var v=0;v<a;v++)for(var g=0;g<i;g++)h[(v+u)*d+g+l]+=n[v*i+g]*c}return s({data:h,width:d,height:f},r,a,e.height,i,e.width)}function f(t,e,r){var a=e.data,o=e.width,d=e.height;void 0===r&&(r="full");var f=u(t,i.ones(d,1),i.ones(1,o),r);return n.multiply2d(f,a[0])}function h(t){for(var e=t.data,r=e[0],n=1;n<e.length;n++)if(e[n]!==r)return!1;return!0}function u(t,e,r,n){void 0===n&&(n="full");var i=Math.max(e.height,e.width),a=Math.max(r.height,r.width),o=d(t,e,"full");return s(d(o,r,"full"),n,t.height,i,t.width,a)}function s(t,e,r,n,i,o){if("full"===e)return t;if("same"===e){var d=Math.ceil((t.height-r)/2),f=Math.ceil((t.width-i)/2);return a.sub(t,d,r,f,i)}return a.sub(t,n-1,r-n+1,o-1,i-o+1)}e.conv2=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t[2]&&t[2].data?u.apply(void 0,t):h(t[1])?f.apply(void 0,t):d.apply(void 0,t)}},346:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.filter2=void 0;var n=r(687);e.filter2=function(t,e,r){return void 0===r&&(r="same"),n.conv2(e,function(t){for(var e=t.data,r=t.width,n=t.height,i=new Array(e.length),a=0;a<n;a++)for(var o=0;o<r;o++)i[a*r+o]=e[(n-1-a)*r+r-1-o];return{data:i,width:r,height:n}}(t),r)}},470:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.fspecial=void 0;var n=r(490);e.fspecial=function(t,e,r){void 0===e&&(e=3),void 0===r&&(r=1.5);var i=function(t,e){for(var r=t.data,n=t.width,i=t.height,a=new Array(r.length),o=0;o<r.length;o++)a[o]=Math.exp(-r[o]/(2*Math.pow(e,2)));return{data:a,width:n,height:i}}(function(t){for(var e=2*t+1,r=new Array(Math.pow(e,2)),n=0;n<e;n++)for(var i=0;i<e;i++)r[n*e+i]=Math.pow(n-t,2)+Math.pow(i-t,2);return{data:r,width:e,height:e}}(e=(e-1)/2),r),a=n.sum2d(i);return n.divide2d(i,a)}},521:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.imfilter=void 0;var n=r(20),i=r(389),a=r(490),o=r(346);e.imfilter=function(t,e,r,d){return void 0===r&&(r="symmetric"),void 0===d&&(d="same"),t=function(t,e,r,o){if(t=i.padarray(t,a.floor([e/2,r/2]),o),0===n.mod(e,2)&&(t.data=t.data.slice(0,-t.width),t.height--),0===n.mod(r,2)){for(var d=[],f=0;f<t.data.length;f++)(f+1)%t.width!=0&&d.push(t.data[f]);t.data=d,t.width--}return t}(t,e.width,e.height,r),d=function(t){return"same"===t&&(t="valid"),t}(d),o.filter2(e,t,d)}},971:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),i=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),i(r(687),e),i(r(346),e),i(r(470),e),i(r(521),e),i(r(150),e),i(r(298),e),i(r(389),e),i(r(582),e),i(r(439),e),i(r(118),e),i(r(240),e),i(r(799),e)},928:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.numbers=void 0,e.numbers=function(t,e,r){for(var n=e*t,i=new Array(n),a=0;a<n;a++)i[a]=r;return{data:i,width:e,height:t}}},20:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.mod=void 0,e.mod=function(t,e){return t-e*Math.floor(t/e)}},150:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.normpdf=void 0,e.normpdf=function(t,e,r){var n=t.data,i=t.width,a=t.height;void 0===e&&(e=0),void 0===r&&(r=1);for(var o=new Array(n.length),d=0;d<n.length;d++){var f=(n[d]-e)/r;o[d]=Math.exp(-Math.pow(f,2)/2)/(2.5066282746310007*r)}return{data:o,width:i,height:a}}},298:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.ones=void 0;var n=r(928);e.ones=function(t,e){return void 0===e&&(e=t),n.numbers(t,e,1)}},389:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.padarray=void 0;var n=r(20);e.padarray=function(t,e,r,i){var a=e[0],o=e[1];return t.height>=a&&t.width>=o?function(t,e){for(var r=e[0],n=e[1],i=t.width+2*n,a=t.height+2*r,o=new Array(i*a),d=-r;d<0;d++){for(var f=-n;f<0;f++)o[(d+r)*i+f+n]=t.data[(Math.abs(d)-1)*t.width+Math.abs(f)-1];for(f=0;f<t.width;f++)o[(d+r)*i+f+n]=t.data[(Math.abs(d)-1)*t.width+f];for(f=t.width;f<t.width+n;f++)o[(d+r)*i+f+n]=t.data[(Math.abs(d)-1)*t.width+2*t.width-f-1]}for(d=0;d<t.height;d++){for(f=-n;f<0;f++)o[(d+r)*i+f+n]=t.data[d*t.width+Math.abs(f)-1];for(f=0;f<t.width;f++)o[(d+r)*i+f+n]=t.data[d*t.width+f];for(f=t.width;f<t.width+n;f++)o[(d+r)*i+f+n]=t.data[d*t.width+2*t.width-f-1]}for(d=t.height;d<t.height+r;d++){for(f=-n;f<0;f++)o[(d+r)*i+f+n]=t.data[(2*t.height-d-1)*t.width+Math.abs(f)-1];for(f=0;f<t.width;f++)o[(d+r)*i+f+n]=t.data[(2*t.height-d-1)*t.width+f];for(f=t.width;f<t.width+n;f++)o[(d+r)*i+f+n]=t.data[(2*t.height-d-1)*t.width+2*t.width-f-1]}return{data:o,width:i,height:a}}(t,[a,o]):function(t,e){for(var r=function(t,e){return{data:t.data.concat(e.data),height:t.height+e.height,width:t.width}}(t,function(t){for(var e=t.data,r=t.width,n=t.height,i=new Array(e.length),a=0;a<n;a++)for(var o=0;o<r;o++)i[a*r+o]=e[(n-1-a)*r+o];return{data:i,width:r,height:n}}(t)),i=t.height+2*e,a=new Array(t.width*i),o=-e;o<t.height+e;o++)for(var d=0;d<t.width;d++)a[(o+e)*t.width+d]=r.data[n.mod(o,r.height)*t.width+d];return{data:a,width:t.width,height:i}}(function(t,e){for(var r=t.width+2*e,i=new Array(r*t.height),a=function(t,e){for(var r=t.width+e.width,n=new Array(t.height*r),i=0;i<t.height;i++){for(var a=0;a<t.width;a++)n[i*r+a]=t.data[i*t.width+a];for(a=0;a<e.width;a++)n[i*r+a+t.width]=e.data[i*e.width+a]}return{data:n,width:r,height:t.height}}(t,function(t){for(var e=t.data,r=t.width,n=t.height,i=new Array(e.length),a=0;a<n;a++)for(var o=0;o<r;o++)i[a*r+o]=e[a*r+r-1-o];return{data:i,width:r,height:n}}(t)),o=0;o<t.height;o++)for(var d=-e;d<t.width+e;d++)i[o*r+d+e]=a.data[o*a.width+n.mod(d,a.width)];return{data:i,width:r,height:t.height}}(t,o),a)}},582:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.rgb2grayInteger=e.rgb2gray=void 0,e.rgb2gray=function(t){for(var e=t.data,r=t.width,n=t.height,i=new Uint8Array(r*n),a=0;a<e.length;a+=4)i[a/4]=.29894*e[a]+.58704*e[a+1]+.11402*e[a+2]+.5;return{data:Array.from(i),width:r,height:n}},e.rgb2grayInteger=function(t){for(var e=t.data,r=t.width,n=t.height,i=new Array(r*n),a=0;a<e.length;a+=4)i[a/4]=77*e[a]+150*e[a+1]+29*e[a+2]+128>>8;return{data:i,width:r,height:n}}},439:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.skip2d=void 0,e.skip2d=function(t,e,r){for(var n=e[0],i=e[1],a=e[2],o=r[0],d=r[1],f=r[2],h=Math.ceil((f-o)/d),u=Math.ceil((a-n)/i),s=new Array(h*u),l=0;l<u;l++)for(var c=0;c<h;c++){var v=n+l*i,g=o+c*d;s[l*h+c]=t.data[v*t.width+g]}return{data:s,width:h,height:u}}},118:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.sub=void 0,e.sub=function(t,e,r,n,i){for(var a=t.data,o=t.width,d=new Array(i*r),f=0;f<r;f++)for(var h=0;h<i;h++)d[f*i+h]=a[(n+f)*o+e+h];return{data:d,width:i,height:r}}},240:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.transpose=void 0,e.transpose=function(t){for(var e=t.data,r=t.width,n=t.height,i=new Array(r*n),a=0;a<n;a++)for(var o=0;o<r;o++)i[o*n+a]=e[a*r+o];return{data:i,height:r,width:n}}},799:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.zeros=void 0;var n=r(928);e.zeros=function(t,e){return void 0===e&&(e=t),n.numbers(t,e,0)}},595:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.originalSsim=void 0;var n=r(490),i=r(971);e.originalSsim=function(t,e,r){var a=i.fspecial("gaussian",r.windowSize,1.5),o=Math.pow(2,r.bitDepth)-1,d=Math.pow(r.k1*o,2),f=Math.pow(r.k2*o,2);a=n.divide2d(a,n.sum2d(a));var h=i.filter2(a,t,"valid"),u=i.filter2(a,e,"valid"),s=n.square2d(h),l=n.square2d(u),c=n.multiply2d(h,u),v=n.square2d(t),g=n.square2d(e),p=n.subtract2d(i.filter2(a,v,"valid"),s),w=n.subtract2d(i.filter2(a,g,"valid"),l),m=n.subtract2d(i.filter2(a,n.multiply2d(t,e),"valid"),c);if(d>0&&f>0){var y=n.add2d(n.multiply2d(c,2),d),b=n.add2d(n.multiply2d(m,2),f),M=n.add2d(n.add2d(s,l),d),x=n.add2d(n.add2d(p,w),f);return n.divide2d(n.multiply2d(y,b),n.multiply2d(M,x))}var _=n.multiply2d(c,2),S=n.multiply2d(m,2),A=n.add2d(s,l),O=n.add2d(p,w);return n.divide2d(n.multiply2d(_,S),n.multiply2d(A,O))}},773:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.ssim=void 0;var n=r(490),i=r(971);e.ssim=function(t,e,r){var a=i.normpdf(function(t){for(var e=Math.floor(t/2),r=new Array(2*e+1),n=-e;n<=e;n++)r[n+e]=Math.abs(n);return{data:r,width:r.length,height:1}}(r.windowSize),0,1.5),o=Math.pow(2,r.bitDepth)-1,d=Math.pow(r.k1*o,2),f=Math.pow(r.k2*o,2);a=n.divide2d(a,n.sum2d(a));var h=i.transpose(a),u=i.conv2(t,a,h,"valid"),s=i.conv2(e,a,h,"valid"),l=n.square2d(u),c=n.square2d(s),v=n.multiply2d(u,s),g=n.square2d(t),p=n.square2d(e),w=n.subtract2d(i.conv2(g,a,h,"valid"),l),m=n.subtract2d(i.conv2(p,a,h,"valid"),c),y=n.subtract2d(i.conv2(n.multiply2d(t,e),a,h,"valid"),v);return d>0&&f>0?function(t,e,r,i,a,o,d,f){var h=n.add2d(n.multiply2d(t,2),d),u=n.add2d(n.multiply2d(e,2),f),s=n.add2d(n.add2d(r,i),d),l=n.add2d(n.add2d(a,o),f);return n.divide2d(n.multiply2d(h,u),n.multiply2d(s,l))}(v,y,l,c,w,m,d,f):function(t,e,r,i,a,o){var d=n.multiply2d(t,2),f=n.multiply2d(e,2),h=n.add2d(r,i),u=n.add2d(a,o);return n.divide2d(n.multiply2d(d,f),n.multiply2d(h,u))}(v,y,l,c,w,m)}},535:function(t,e){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function n(t,e,r,n){return{rightEdge:r[e*n+t+1],bottomEdge:r[(e+1)*n+t],bottomRightEdge:r[(e+1)*n+t+1]}}function i(t,e){for(var r=t.width,i=t.height,a=t.data,o=r+1,d=i+1,f=new Int32Array(o*d),h=i-1;h>=0;--h)for(var u=r-1;u>=0;--u){var s=n(u,h,f,o),l=s.rightEdge,c=s.bottomEdge,v=s.bottomRightEdge;f[h*o+u]=e(a[h*r+u],u,h)+l+c-v}return{data:f,height:d,width:o}}function a(t,e,r){for(var i=t.width,a=t.height,o=t.data,d=e.data,f=i+1,h=a+1,u=new Int32Array(f*h),s=a-1;s>=0;--s)for(var l=i-1;l>=0;--l){var c=n(l,s,u,f),v=c.rightEdge,g=c.bottomEdge,p=c.bottomRightEdge,w=s*i+l;u[s*f+l]=r(o[w],d[w],l,s)+v+g-p}return{data:u,height:h,width:f}}function o(t,e,r){for(var n=t.width,i=t.height,a=t.data,o=n-1,d=i-1,f=o-e+1,h=d-e+1,u=new Int32Array(f*h),s=0;s<d;++s)for(var l=0;l<o;++l)if(l<f&&s<h){var c=a[n*s+l]-a[n*s+l+e]-a[n*(s+e)+l]+a[n*(s+e)+l+e];u[s*f+l]=c/r}return{height:h,width:f,data:u}}function d(t,e){return o(i(t,(function(t){return t})),e,1)}function f(t,e,r){for(var n=r*r,a=o(i(t,(function(t){return t*t})),r,1),d=0;d<e.data.length;++d){var f=e.data[d]/n,h=a.data[d]/n,u=f*f;a.data[d]=1024*(h-u)}return a}function h(t,e,r,n,i){for(var d=i*i,f=o(a(t,e,(function(t,e){return t*e})),i,1),h=0;h<r.data.length;++h)f.data[h]=1024*(f.data[h]/d-r.data[h]/d*(n.data[h]/d));return f}Object.defineProperty(e,"__esModule",{value:!0}),e.weberSsim=e.windowCovariance=e.windowVariance=e.windowSums=e.windowMatrix=e.partialSumMatrix2=e.partialSumMatrix1=void 0,e.partialSumMatrix1=i,e.partialSumMatrix2=a,e.windowMatrix=o,e.windowSums=d,e.windowVariance=f,e.windowCovariance=h,e.weberSsim=function(t,e,n){for(var i=n.bitDepth,a=n.k1,o=n.k2,u=n.windowSize,s=Math.pow(2,i)-1,l=a*s*(a*s),c=o*s*(o*s),v=u*u,g=r(r({},t),{data:Int32Array.from(t.data,(function(t){return t+.5}))}),p=r(r({},e),{data:Int32Array.from(e.data,(function(t){return t+.5}))}),w=d(g,u),m=f(g,w,u),y=d(p,u),b=f(p,y,u),M=h(g,p,w,y,u),x=w.data.length,_=0,S=new Array(x),A=0;A<x;++A){var O=w.data[A]/v,j=y.data[A]/v,P=m.data[A]/1024,D=b.data[A]/1024,k=(2*O*j+l)*(M.data[A]/1024*2+c)/(O*O+j*j+l)/(P+D+c);S[A]=k,0==A?_=k:_+=(k-_)/(A+1)}return{data:S,width:w.width,height:w.height,mssim:_}}}},e={};return function r(n){if(e[n])return e[n].exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}(607)}()},function(t,e,r){"use strict";var n=r(3);t.exports=function(t,e,r,d,h,u){if(!a(t)||!a(e)||r&&!a(r))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(t.length!==e.length||r&&r.length!==t.length)throw new Error("Image sizes do not match.");if(t.length!==d*h*4)throw new Error("Image data size does not match width/height.");u=Object.assign({},i,u);for(var s=d*h,l=new Uint32Array(t.buffer,t.byteOffset,s),g=new Uint32Array(e.buffer,e.byteOffset,s),p=!0,w=0;w<s;w++)if(l[w]!==g[w]){p=!1;break}if(p){if(r&&!u.diffMask)for(var m=0;m<s;m++)v(t,4*m,u.alpha,r);return 0}for(var y=35215*u.threshold*u.threshold,b=0,M=0;M<h;M++)for(var x=0;x<d;x++){var _=4*(M*d+x),S=f(t,e,_,_);Math.abs(S)>y?u.includeAA||!o(t,x,M,d,h,e)&&!o(e,x,M,d,h,t)?(r&&c.apply(void 0,[r,_].concat(n(S<0&&u.diffColorAlt||u.diffColor))),b++):r&&!u.diffMask&&c.apply(void 0,[r,_].concat(n(u.aaColor))):r&&(u.diffMask||v(t,_,u.alpha,r))}return b};var i={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffColorAlt:null,diffMask:!1};function a(t){return ArrayBuffer.isView(t)&&1===t.constructor.BYTES_PER_ELEMENT}function o(t,e,r,n,i,a){for(var o,h,u,s,l=Math.max(e-1,0),c=Math.max(r-1,0),v=Math.min(e+1,n-1),g=Math.min(r+1,i-1),p=4*(r*n+e),w=e===l||e===v||r===c||r===g?1:0,m=0,y=0,b=l;b<=v;b++)for(var M=c;M<=g;M++)if(b!==e||M!==r){var x=f(t,t,p,4*(M*n+b),!0);if(0===x){if(++w>2)return!1}else x<m?(m=x,o=b,h=M):x>y&&(y=x,u=b,s=M)}return 0!==m&&0!==y&&(d(t,o,h,n,i)&&d(a,o,h,n,i)||d(t,u,s,n,i)&&d(a,u,s,n,i))}function d(t,e,r,n,i){for(var a=Math.max(e-1,0),o=Math.max(r-1,0),d=Math.min(e+1,n-1),f=Math.min(r+1,i-1),h=4*(r*n+e),u=e===a||e===d||r===o||r===f?1:0,s=a;s<=d;s++)for(var l=o;l<=f;l++)if(s!==e||l!==r){var c=4*(l*n+s);if(t[h]===t[c]&&t[h+1]===t[c+1]&&t[h+2]===t[c+2]&&t[h+3]===t[c+3]&&u++,u>2)return!0}return!1}function f(t,e,r,n,i){var a=t[r+0],o=t[r+1],d=t[r+2],f=t[r+3],c=e[n+0],v=e[n+1],g=e[n+2],p=e[n+3];if(f===p&&a===c&&o===v&&d===g)return 0;f<255&&(a=l(a,f/=255),o=l(o,f),d=l(d,f)),p<255&&(c=l(c,p/=255),v=l(v,p),g=l(g,p));var w=h(a,o,d),m=h(c,v,g),y=w-m;if(i)return y;var b=u(a,o,d)-u(c,v,g),M=s(a,o,d)-s(c,v,g),x=.5053*y*y+.299*b*b+.1957*M*M;return w>m?-x:x}function h(t,e,r){return.29889531*t+.58662247*e+.11448223*r}function u(t,e,r){return.59597799*t-.2741761*e-.32180189*r}function s(t,e,r){return.21147017*t-.52261711*e+.31114694*r}function l(t,e){return 255+(t-255)*e}function c(t,e,r,n,i){t[e+0]=r,t[e+1]=n,t[e+2]=i,t[e+3]=255}function v(t,e,r,n){var i=l(h(t[e+0],t[e+1],t[e+2]),r*t[e+3]/255);c(n,e,i,i,i)}},function(t,e,r){var n=r(4),i=r(5),a=r(6),o=r(7);t.exports=function(t){return n(t)||i(t)||a(t)||o()}},function(t,e,r){var n=r(0);t.exports=function(t){if(Array.isArray(t))return n(t)}},function(t,e){t.exports=function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,e,r){var n=r(0);t.exports=function(t,e){if(t){if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,r){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function i(t,e){if(t){if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}function a(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.r(e);var o=r(1),d=r.n(o),f=r(2),h=r.n(f);function u(t){return 3===t.length?"rgb(".concat(t[0],",").concat(t[1],",").concat(t[2],")"):"rgba(".concat(t[0],",").concat(t[1],",").concat(t[2],",").concat(t[3],")")}function s(t,e){if(t&&0!==e.vertices.length){t.fillStyle=u(e.color),t.beginPath();var r=e.vertices[0];t.moveTo(r.x,r.y);for(var n=1;n<e.vertices.length;n++)r=e.vertices[n],t.lineTo(r.x,r.y);t.closePath(),t.fill()}}function l(t,e,r,n){var i=2*Math.random()*Math.PI,a=Math.random()*e,o=t.x+Math.floor(Math.cos(i)*a);o=Math.max(0,Math.min(o,r));var d=t.y+Math.floor(Math.sin(i)*a);return{x:o,y:d=Math.max(0,Math.min(d,n))}}function c(t,e,r,n,i){for(var a=[],o=0;o<t;o++){for(var d=v(0,n,!0),f=v(0,i,!0),h=0;h<e;h++)a.push(d+v(0,n/2,!0)),a.push(f+v(0,i/2,!0));for(var u=0;u<r;u++){var s=u<3?v(0,256,!0):v(.2,1,!1);a.push(s)}}return{id:Date.now(),genes:a,fitness:0,ssim:0,pixelDiff:0,diff:void 0,probability:0,phenotype:[]}}function v(t,e,r){var n=Math.random()*(e-t)+t;return n=r?Math.floor(n):Math.round(1e3*n)/1e3}function g(t){var e,r=0,n=[],o=a(t),d=function(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=i(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,d=!0,f=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return d=t.done,t},e:function(t){f=!0,o=t},f:function(){try{d||null==r.return||r.return()}finally{if(f)throw o}}}}(t);try{for(d.s();!(e=d.n()).done;){var f=e.value,h=f.fitness*f.fitness;n.push(h),r+=h}}catch(l){d.e(l)}finally{d.f()}for(var u=0,s=0;s<n.length;s++){u+=n[s]/r,o[s].probability=u}return o[o.length-1].probability=1,o}function p(t){for(var e=Math.random(),r=0;r<t.length&&t[r].probability<=e;)r++;return r===t.length&&(r-=1),t[r]}function w(t,e){for(var r={id:0,genes:[],fitness:0,ssim:0,pixelDiff:0,diff:void 0,probability:0,phenotype:[]},n=0;n<e;n++){var i=t[Math.floor(Math.random()*t.length)];(0===r.id||i.fitness>r.fitness)&&(r=i)}return r}function m(t,e,r,n,i,a){switch(r){case"polygon":return function(t,e,r,n,i){var a={genes:[],fitness:0,ssim:0,pixelDiff:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},o=t.fitness>e.fitness?r:1-r,d=0;for(;d<t.genes.length;){var f=2*n+i,h=Math.random()<o?t.genes:e.genes;a.genes=a.genes.concat(h.slice(d,d+f)),d+=f}return a}(t,e,n,i,a);case"vertex":return function(t,e,r,n,i){var a={genes:[],fitness:0,ssim:0,pixelDiff:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},o=t.fitness>e.fitness?r:1-r,d=0;for(;d<t.genes.length;){if(d%(2*n+i)<2*n){var f=Math.random()<o?t.genes:e.genes,h={x:f[d],y:f[d+1]};a.genes.push(h.x),a.genes.push(h.y),d+=2}else{var u=Math.random()<o?t.genes:e.genes;a.genes.push(u[d]),a.genes.push(u[d+1]),a.genes.push(u[d+2]),d+=3,4===i&&(a.genes.push(u[d]),d++)}}return a}(t,e,n,i,a);case"data":return function(t,e,r,n,i){var a={genes:[],fitness:0,ssim:0,pixelDiff:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},o=t.fitness>e.fitness?r:1-r,d=0;for(;d<t.genes.length;){var f=Math.random()<o?t.genes:e.genes;a.genes.push(f[d]),d++}return a}(t,e,n);default:return t}}e.default={};function y(t,e,r,n,i,a,o,f,u){t.phenotype=function(t,e,r){for(var n=[],i=2*e+r,a=0;a<t.length;a+=i){for(var o={vertices:[],color:[]},d=2*e,f=0;f<d;f+=2){var h={x:t[a+f],y:t[a+f+1]};o.vertices.push(h)}for(var u=0;u<r;u++)o.color.push(t[a+d+u]);n.push(o)}return n}(t.genes,a,o),u.clearRect(0,0,f.width,f.height),u.fillStyle="#000000",u.fillRect(0,0,f.width,f.height);for(var l=0;l<t.phenotype.length;l++){s(u,t.phenotype[l])}var c=u.getImageData(0,0,f.width,f.height),v={mssim:0},g=n;if(e){v=d()(f,c,{rgb2grayVersion:"original",windowSize:11,k1:.01,k2:.03,bitDepth:8,downsample:"original",ssim:"weber"})}else g=0;var p=void 0,w=0,m=i;if(r){var y=new OffscreenCanvas(f.width,f.height).getContext("2d"),b=0;y&&(p=y.createImageData(f.width,f.height),b=h()(f.data,c.data,p.data,f.width,f.height,{threshold:.1})),w=(f.width*f.height-b)/(f.width*f.height)}else m=0;return{fitness:(v.mssim*g+w*m)/(g+m),ssim:v.mssim,pixelDiff:w,diff:p}}function b(t,e,r,n,i,a,o,d,f){for(var h={genes:[],fitness:0,ssim:0,pixelDiff:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},u=f?1:e,s=0,c=2*i+a;s<t.genes.length;)if(Math.random()<u){var g=s%c,p=g>=2*i;if(g%2===0&&g<2*i){var w={x:t.genes[s],y:t.genes[s+1]},m=Math.max(o,d)*r,y=v(-m,m,!1);y>-1&&y<=0&&(y=-1),y<1&&y>=0&&(y=1),w=l(w,y,o,d),h.genes.push(w.x),h.genes.push(w.y),s+=2}else if(p){var b=v(-n,n,!1),M=t.genes[s]+t.genes[s]*b;4===a&&g===c-1?M=Math.max(0,Math.min(M,1)):(M=Math.round(M),M=Math.max(.2,Math.min(M,255))),h.genes.push(M),s++}else h.genes.push(t.genes[s]),s++}else h.genes.push(t.genes[s]),s++;return h.genes=h.genes.concat([]),h}self.addEventListener("message",(function(t){if(t){var e=t.data,r=e.configuration,n=r.enableTransparency?4:3,i=e.population,o=e.best,d=e.image,f=new OffscreenCanvas(e.renderingWidth,e.renderingHeight).getContext("2d"),h=new OffscreenCanvas(e.renderingWidth,e.renderingHeight).getContext("2d");if(f&&h){h.putImageData(d,0,0);var u=h.getImageData(0,0,e.renderingWidth,e.renderingHeight),s=[],l=(new Date).getTime();if(0===i.length)s=function(t,e,r,n,i,o,d,f,h){if(!h)return a(t);for(var u=[],s=0;s<t.length;s++){var l=t[s],c=y(l,e,r,n,i,o,d,f,h),v={genes:a(l.genes),fitness:c.fitness,ssim:c.ssim,pixelDiff:c.pixelDiff,diff:c.diff,probability:0,id:l.id,phenotype:a(l.phenotype)};u.push(v)}return u}(s=function(t,e,r,n,i,a){for(var o=[],d=0;d<t;d++){var f=c(e,r,n,i,a);o.push(f)}return o}(r.population,r.nbPolygons,r.nbVertex,n,e.renderingWidth,e.renderingHeight),r.enableSsim,r.enablePixelDiff,r.ratioSsim,r.ratioPixelDiff,r.nbVertex,n,u,f);else{o.id!==i[0].id&&(i=g([].concat(a(i),[o])));for(var v=function(t,e){for(var r=[],n=0;n<e;n++){var i=p(t);r.push(i)}return r}(i=a(i).sort((function(t,e){return t.probability-e.probability})),Math.round(i.length*r.selectCutoff)),M=0;M<r.population;M++){var x=Math.random();if(x<.1){var _=b(p(i),r.mutationRate,r.vertexMovement,r.colorModificationRate,r.nbVertex,n,e.renderingWidth,e.renderingHeight,!1),S=y(_,r.enableSsim,r.enablePixelDiff,r.ratioSsim,r.ratioPixelDiff,r.nbVertex,n,u,f);_.fitness=S.fitness,_.ssim=S.ssim,_.pixelDiff=S.pixelDiff,_.diff=S.diff,s.push(_)}else if(x<.2){var A=c(r.nbPolygons,r.nbVertex,n,e.renderingWidth,e.renderingHeight),O=y(A,r.enableSsim,r.enablePixelDiff,r.ratioSsim,r.ratioPixelDiff,r.nbVertex,n,u,f);A.fitness=O.fitness,A.ssim=O.ssim,A.pixelDiff=O.pixelDiff,A.diff=O.diff,s.push(A)}else{var j=void 0,P=void 0;"tournament"===r.parentSelectionStrategy?(j=w(v,r.tournamentSize),P=w(v,r.tournamentSize)):(j=p(i),P=p(i));var D=m(j,P,r.crossoverStrategy,r.crossoverParentRatio,r.nbVertex,n),k=y(D=b(D,r.mutationRate,r.vertexMovement,r.colorModificationRate,r.nbVertex,n,e.renderingWidth,e.renderingHeight,!1),r.enableSsim,r.enablePixelDiff,r.ratioSsim,r.ratioPixelDiff,r.nbVertex,n,u,f);D.fitness=k.fitness,D.ssim=k.ssim,D.pixelDiff=k.pixelDiff,D.diff=k.diff,s.push(D)}}}s=function(t){return a(t).sort((function(t,e){return e.fitness-t.fitness}))}(s);var I,E=((new Date).getTime()-l)/1e3,z=e.notImprovingSince;o&&o.fitness>s[0].fitness?(I=o,z++):(I=s[0],z=0);var C={isRunning:!0,best:I,population:s,generation:e.generation+1,elapsedTime:E,notImprovingSince:z};postMessage(C)}else{console.error("no ctx to draw the image");var T={isRunning:!0,best:o,population:a(i),generation:e.generation,elapsedTime:0,notImprovingSince:0};postMessage(T)}}}))}]);
//# sourceMappingURL=test.worker.e01b56fa.js.map