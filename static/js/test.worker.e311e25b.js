!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/react_ag_image/",r(r.s=8)}([function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}},function(t,e,r){self,t.exports=function(){"use strict";var t={132:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.bezkrovnySsim=void 0;var n=r(490),i=r(971);function a(t,e,r){var i=t.data,a=e.data,o=r.bitDepth,d=r.k1,f=r.k2,u=Math.pow(2,o)-1,h=Math.pow(d*u,2),s=Math.pow(f*u,2),l=n.average(i),c=n.average(a),v=n.variance(i,l),g=n.variance(a,c);return(2*l*c+h)*(2*n.covariance(i,a,l,c)+s)/((Math.pow(l,2)+Math.pow(c,2)+h)*(v+g+s))}e.bezkrovnySsim=function(t,e,r){for(var n=r.windowSize,o=Math.ceil(t.width/n),d=Math.ceil(t.height/n),f=new Array(o*d),u=0,h=0;h<t.height;h+=n)for(var s=0;s<t.width;s+=n){var l=Math.min(n,t.width-s),c=Math.min(n,t.height-h),v=i.sub(t,s,c,h,l),g=i.sub(e,s,c,h,l);f[u++]=a(v,g,r)}return{data:f,width:o,height:d}}},63:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.defaults=void 0,e.defaults={windowSize:11,k1:.01,k2:.03,bitDepth:8,downsample:"original",ssim:"weber",maxSize:256,rgb2grayVersion:"integer"}},441:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.downsample=void 0;var n=r(490),i=r(971);function a(t,e,r){var n=i.imfilter(t,e,"symmetric","same");return i.skip2d(n,[0,r,n.height],[0,r,n.width])}e.downsample=function(t,e){return"original"===e.downsample?function(t,e,r){void 0===r&&(r=256);var o=Math.min(t.width,e.height)/r,d=Math.round(o);if(d>1){var f=i.ones(d);t=a(t,f=n.divide2d(f,n.sum2d(f)),d),e=a(e,f,d)}return[t,e]}(t[0],t[1],e.maxSize):t}},607:function(t,e,r){var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ssim=e.getOptions=void 0;var i=r(971),a=r(490),o=r(773),d=r(595),f=r(132),u=r(441),h=r(63),s=r(535),l={fast:o.ssim,original:d.originalSsim,bezkrovny:f.bezkrovnySsim,weber:s.weberSsim};function c(t){var e=n(n({},h.defaults),t);return function(t){if(Object.keys(t).forEach((function(t){if(!(t in h.defaults))throw new Error('"'+t+'" is not a valid option')})),"k1"in t&&("number"!=typeof t.k1||t.k1<0))throw new Error("Invalid k1 value. Default is "+h.defaults.k1);if("k2"in t&&("number"!=typeof t.k2||t.k2<0))throw new Error("Invalid k2 value. Default is "+h.defaults.k2);if(!(t.ssim in l))throw new Error("Invalid ssim option (use: "+Object.keys(l).join(", ")+")")}(e),e}function v(t,e,r){var n,o,d,f,h=(new Date).getTime(),s=function(t){var e=t[0],r=t[1],n=t[2];return l[n.ssim](e,r,n)}(function(t){var e=t[0],r=t[1],n=t[2],i=u.downsample([e,r],n);return[i[0],i[1],n]}((o=(n=function(t){var e=t[0],r=t[1],n=t[2];if(e.width!==r.width||e.height!==r.height)throw new Error("Image dimensions do not match");return[e,r,n]}([t,e,c(r)]))[0],d=n[1],"original"===(f=n[2]).rgb2grayVersion?[i.rgb2gray(o),i.rgb2gray(d),f]:[i.rgb2grayInteger(o),i.rgb2grayInteger(d),f])));return{mssim:void 0!==s.mssim?s.mssim:a.mean2d(s),ssim_map:s,performance:(new Date).getTime()-h}}e.getOptions=c,e.ssim=v,e.default=v},490:function(t,e){function r(t){return n(t)/t.length}function n(t){for(var e=0,r=0;r<t.length;r++)e+=t[r];return e}function i(t){for(var e=t.data,r=0,n=0;n<e.length;n++)r+=e[n];return r}function a(t,e){for(var r=t.data,n=t.width,i=t.height,a=new Array(r.length),o=0;o<r.length;o++)a[o]=r[o]+e;return{data:a,width:n,height:i}}function o(t,e){return"number"==typeof e?function(t,e){for(var r=t.data,n=t.width,i=t.height,a=new Array(r.length),o=0;o<r.length;o++)a[o]=r[o]*e;return{data:a,width:n,height:i}}(t,e):function(t,e){for(var r=t.data,n=t.width,i=t.height,a=e.data,o=new Array(r.length),d=0;d<r.length;d++)o[d]=r[d]*a[d];return{data:o,width:n,height:i}}(t,e)}Object.defineProperty(e,"__esModule",{value:!0}),e.covariance=e.variance=e.mean2d=e.square2d=e.multiply2d=e.divide2d=e.subtract2d=e.add2d=e.sum2d=e.floor=e.sum=e.average=void 0,e.average=r,e.sum=n,e.floor=function(t){for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=Math.floor(t[r]);return e},e.sum2d=i,e.add2d=function(t,e){return"number"==typeof e?a(t,e):function(t,e){for(var r=t.data,n=t.width,i=t.height,a=e.data,o=new Array(r.length),d=0;d<i;d++)for(var f=d*n,u=0;u<n;u++)o[f+u]=r[f+u]+a[f+u];return{data:o,width:n,height:i}}(t,e)},e.subtract2d=function(t,e){return"number"==typeof e?a(t,-e):function(t,e){for(var r=t.data,n=t.width,i=t.height,a=e.data,o=new Array(r.length),d=0;d<i;d++)for(var f=d*n,u=0;u<n;u++)o[f+u]=r[f+u]-a[f+u];return{data:o,width:n,height:i}}(t,e)},e.divide2d=function(t,e){return"number"==typeof e?function(t,e){for(var r=t.data,n=t.width,i=t.height,a=new Array(r.length),o=0;o<r.length;o++)a[o]=r[o]/e;return{data:a,width:n,height:i}}(t,e):function(t,e){for(var r=t.data,n=t.width,i=t.height,a=e.data,o=new Array(r.length),d=0;d<r.length;d++)o[d]=r[d]/a[d];return{data:o,width:n,height:i}}(t,e)},e.multiply2d=o,e.square2d=function(t){return o(t,t)},e.mean2d=function(t){return i(t)/t.data.length},e.variance=function(t,e){void 0===e&&(e=r(t));for(var n=0,i=t.length;i--;)n+=Math.pow(t[i]-e,2);return n/t.length},e.covariance=function(t,e,n,i){void 0===n&&(n=r(t)),void 0===i&&(i=r(e));for(var a=0,o=t.length;o--;)a+=(t[o]-n)*(e[o]-i);return a/t.length}},687:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.conv2=void 0;var n=r(490),i=r(298),a=r(118),o=r(799);function d(t,e,r){var n=t.data,i=t.width,a=t.height;void 0===r&&(r="full");for(var d=i+e.width-1,f=a+e.height-1,u=o.zeros(f,d).data,h=0;h<e.height;h++)for(var l=0;l<e.width;l++){var c=e.data[h*e.width+l];if(c)for(var v=0;v<a;v++)for(var g=0;g<i;g++)u[(v+h)*d+g+l]+=n[v*i+g]*c}return s({data:u,width:d,height:f},r,a,e.height,i,e.width)}function f(t,e,r){var a=e.data,o=e.width,d=e.height;void 0===r&&(r="full");var f=h(t,i.ones(d,1),i.ones(1,o),r);return n.multiply2d(f,a[0])}function u(t){for(var e=t.data,r=e[0],n=1;n<e.length;n++)if(e[n]!==r)return!1;return!0}function h(t,e,r,n){void 0===n&&(n="full");var i=Math.max(e.height,e.width),a=Math.max(r.height,r.width),o=d(t,e,"full");return s(d(o,r,"full"),n,t.height,i,t.width,a)}function s(t,e,r,n,i,o){if("full"===e)return t;if("same"===e){var d=Math.ceil((t.height-r)/2),f=Math.ceil((t.width-i)/2);return a.sub(t,d,r,f,i)}return a.sub(t,n-1,r-n+1,o-1,i-o+1)}e.conv2=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t[2]&&t[2].data?h.apply(void 0,t):u(t[1])?f.apply(void 0,t):d.apply(void 0,t)}},346:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.filter2=void 0;var n=r(687);e.filter2=function(t,e,r){return void 0===r&&(r="same"),n.conv2(e,function(t){for(var e=t.data,r=t.width,n=t.height,i=new Array(e.length),a=0;a<n;a++)for(var o=0;o<r;o++)i[a*r+o]=e[(n-1-a)*r+r-1-o];return{data:i,width:r,height:n}}(t),r)}},470:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.fspecial=void 0;var n=r(490);e.fspecial=function(t,e,r){void 0===e&&(e=3),void 0===r&&(r=1.5);var i=function(t,e){for(var r=t.data,n=t.width,i=t.height,a=new Array(r.length),o=0;o<r.length;o++)a[o]=Math.exp(-r[o]/(2*Math.pow(e,2)));return{data:a,width:n,height:i}}(function(t){for(var e=2*t+1,r=new Array(Math.pow(e,2)),n=0;n<e;n++)for(var i=0;i<e;i++)r[n*e+i]=Math.pow(n-t,2)+Math.pow(i-t,2);return{data:r,width:e,height:e}}(e=(e-1)/2),r),a=n.sum2d(i);return n.divide2d(i,a)}},521:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.imfilter=void 0;var n=r(20),i=r(389),a=r(490),o=r(346);e.imfilter=function(t,e,r,d){return void 0===r&&(r="symmetric"),void 0===d&&(d="same"),t=function(t,e,r,o){if(t=i.padarray(t,a.floor([e/2,r/2]),o),0===n.mod(e,2)&&(t.data=t.data.slice(0,-t.width),t.height--),0===n.mod(r,2)){for(var d=[],f=0;f<t.data.length;f++)(f+1)%t.width!=0&&d.push(t.data[f]);t.data=d,t.width--}return t}(t,e.width,e.height,r),d=function(t){return"same"===t&&(t="valid"),t}(d),o.filter2(e,t,d)}},971:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),i=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),i(r(687),e),i(r(346),e),i(r(470),e),i(r(521),e),i(r(150),e),i(r(298),e),i(r(389),e),i(r(582),e),i(r(439),e),i(r(118),e),i(r(240),e),i(r(799),e)},928:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.numbers=void 0,e.numbers=function(t,e,r){for(var n=e*t,i=new Array(n),a=0;a<n;a++)i[a]=r;return{data:i,width:e,height:t}}},20:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.mod=void 0,e.mod=function(t,e){return t-e*Math.floor(t/e)}},150:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.normpdf=void 0,e.normpdf=function(t,e,r){var n=t.data,i=t.width,a=t.height;void 0===e&&(e=0),void 0===r&&(r=1);for(var o=new Array(n.length),d=0;d<n.length;d++){var f=(n[d]-e)/r;o[d]=Math.exp(-Math.pow(f,2)/2)/(2.5066282746310007*r)}return{data:o,width:i,height:a}}},298:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.ones=void 0;var n=r(928);e.ones=function(t,e){return void 0===e&&(e=t),n.numbers(t,e,1)}},389:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.padarray=void 0;var n=r(20);e.padarray=function(t,e,r,i){var a=e[0],o=e[1];return t.height>=a&&t.width>=o?function(t,e){for(var r=e[0],n=e[1],i=t.width+2*n,a=t.height+2*r,o=new Array(i*a),d=-r;d<0;d++){for(var f=-n;f<0;f++)o[(d+r)*i+f+n]=t.data[(Math.abs(d)-1)*t.width+Math.abs(f)-1];for(f=0;f<t.width;f++)o[(d+r)*i+f+n]=t.data[(Math.abs(d)-1)*t.width+f];for(f=t.width;f<t.width+n;f++)o[(d+r)*i+f+n]=t.data[(Math.abs(d)-1)*t.width+2*t.width-f-1]}for(d=0;d<t.height;d++){for(f=-n;f<0;f++)o[(d+r)*i+f+n]=t.data[d*t.width+Math.abs(f)-1];for(f=0;f<t.width;f++)o[(d+r)*i+f+n]=t.data[d*t.width+f];for(f=t.width;f<t.width+n;f++)o[(d+r)*i+f+n]=t.data[d*t.width+2*t.width-f-1]}for(d=t.height;d<t.height+r;d++){for(f=-n;f<0;f++)o[(d+r)*i+f+n]=t.data[(2*t.height-d-1)*t.width+Math.abs(f)-1];for(f=0;f<t.width;f++)o[(d+r)*i+f+n]=t.data[(2*t.height-d-1)*t.width+f];for(f=t.width;f<t.width+n;f++)o[(d+r)*i+f+n]=t.data[(2*t.height-d-1)*t.width+2*t.width-f-1]}return{data:o,width:i,height:a}}(t,[a,o]):function(t,e){for(var r=function(t,e){return{data:t.data.concat(e.data),height:t.height+e.height,width:t.width}}(t,function(t){for(var e=t.data,r=t.width,n=t.height,i=new Array(e.length),a=0;a<n;a++)for(var o=0;o<r;o++)i[a*r+o]=e[(n-1-a)*r+o];return{data:i,width:r,height:n}}(t)),i=t.height+2*e,a=new Array(t.width*i),o=-e;o<t.height+e;o++)for(var d=0;d<t.width;d++)a[(o+e)*t.width+d]=r.data[n.mod(o,r.height)*t.width+d];return{data:a,width:t.width,height:i}}(function(t,e){for(var r=t.width+2*e,i=new Array(r*t.height),a=function(t,e){for(var r=t.width+e.width,n=new Array(t.height*r),i=0;i<t.height;i++){for(var a=0;a<t.width;a++)n[i*r+a]=t.data[i*t.width+a];for(a=0;a<e.width;a++)n[i*r+a+t.width]=e.data[i*e.width+a]}return{data:n,width:r,height:t.height}}(t,function(t){for(var e=t.data,r=t.width,n=t.height,i=new Array(e.length),a=0;a<n;a++)for(var o=0;o<r;o++)i[a*r+o]=e[a*r+r-1-o];return{data:i,width:r,height:n}}(t)),o=0;o<t.height;o++)for(var d=-e;d<t.width+e;d++)i[o*r+d+e]=a.data[o*a.width+n.mod(d,a.width)];return{data:i,width:r,height:t.height}}(t,o),a)}},582:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.rgb2grayInteger=e.rgb2gray=void 0,e.rgb2gray=function(t){for(var e=t.data,r=t.width,n=t.height,i=new Uint8Array(r*n),a=0;a<e.length;a+=4)i[a/4]=.29894*e[a]+.58704*e[a+1]+.11402*e[a+2]+.5;return{data:Array.from(i),width:r,height:n}},e.rgb2grayInteger=function(t){for(var e=t.data,r=t.width,n=t.height,i=new Array(r*n),a=0;a<e.length;a+=4)i[a/4]=77*e[a]+150*e[a+1]+29*e[a+2]+128>>8;return{data:i,width:r,height:n}}},439:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.skip2d=void 0,e.skip2d=function(t,e,r){for(var n=e[0],i=e[1],a=e[2],o=r[0],d=r[1],f=r[2],u=Math.ceil((f-o)/d),h=Math.ceil((a-n)/i),s=new Array(u*h),l=0;l<h;l++)for(var c=0;c<u;c++){var v=n+l*i,g=o+c*d;s[l*u+c]=t.data[v*t.width+g]}return{data:s,width:u,height:h}}},118:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.sub=void 0,e.sub=function(t,e,r,n,i){for(var a=t.data,o=t.width,d=new Array(i*r),f=0;f<r;f++)for(var u=0;u<i;u++)d[f*i+u]=a[(n+f)*o+e+u];return{data:d,width:i,height:r}}},240:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.transpose=void 0,e.transpose=function(t){for(var e=t.data,r=t.width,n=t.height,i=new Array(r*n),a=0;a<n;a++)for(var o=0;o<r;o++)i[o*n+a]=e[a*r+o];return{data:i,height:r,width:n}}},799:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.zeros=void 0;var n=r(928);e.zeros=function(t,e){return void 0===e&&(e=t),n.numbers(t,e,0)}},595:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.originalSsim=void 0;var n=r(490),i=r(971);e.originalSsim=function(t,e,r){var a=i.fspecial("gaussian",r.windowSize,1.5),o=Math.pow(2,r.bitDepth)-1,d=Math.pow(r.k1*o,2),f=Math.pow(r.k2*o,2);a=n.divide2d(a,n.sum2d(a));var u=i.filter2(a,t,"valid"),h=i.filter2(a,e,"valid"),s=n.square2d(u),l=n.square2d(h),c=n.multiply2d(u,h),v=n.square2d(t),g=n.square2d(e),p=n.subtract2d(i.filter2(a,v,"valid"),s),w=n.subtract2d(i.filter2(a,g,"valid"),l),m=n.subtract2d(i.filter2(a,n.multiply2d(t,e),"valid"),c);if(d>0&&f>0){var y=n.add2d(n.multiply2d(c,2),d),b=n.add2d(n.multiply2d(m,2),f),M=n.add2d(n.add2d(s,l),d),x=n.add2d(n.add2d(p,w),f);return n.divide2d(n.multiply2d(y,b),n.multiply2d(M,x))}var S=n.multiply2d(c,2),_=n.multiply2d(m,2),A=n.add2d(s,l),P=n.add2d(p,w);return n.divide2d(n.multiply2d(S,_),n.multiply2d(A,P))}},773:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),e.ssim=void 0;var n=r(490),i=r(971);e.ssim=function(t,e,r){var a=i.normpdf(function(t){for(var e=Math.floor(t/2),r=new Array(2*e+1),n=-e;n<=e;n++)r[n+e]=Math.abs(n);return{data:r,width:r.length,height:1}}(r.windowSize),0,1.5),o=Math.pow(2,r.bitDepth)-1,d=Math.pow(r.k1*o,2),f=Math.pow(r.k2*o,2);a=n.divide2d(a,n.sum2d(a));var u=i.transpose(a),h=i.conv2(t,a,u,"valid"),s=i.conv2(e,a,u,"valid"),l=n.square2d(h),c=n.square2d(s),v=n.multiply2d(h,s),g=n.square2d(t),p=n.square2d(e),w=n.subtract2d(i.conv2(g,a,u,"valid"),l),m=n.subtract2d(i.conv2(p,a,u,"valid"),c),y=n.subtract2d(i.conv2(n.multiply2d(t,e),a,u,"valid"),v);return d>0&&f>0?function(t,e,r,i,a,o,d,f){var u=n.add2d(n.multiply2d(t,2),d),h=n.add2d(n.multiply2d(e,2),f),s=n.add2d(n.add2d(r,i),d),l=n.add2d(n.add2d(a,o),f);return n.divide2d(n.multiply2d(u,h),n.multiply2d(s,l))}(v,y,l,c,w,m,d,f):function(t,e,r,i,a,o){var d=n.multiply2d(t,2),f=n.multiply2d(e,2),u=n.add2d(r,i),h=n.add2d(a,o);return n.divide2d(n.multiply2d(d,f),n.multiply2d(u,h))}(v,y,l,c,w,m)}},535:function(t,e){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function n(t,e,r,n){return{rightEdge:r[e*n+t+1],bottomEdge:r[(e+1)*n+t],bottomRightEdge:r[(e+1)*n+t+1]}}function i(t,e){for(var r=t.width,i=t.height,a=t.data,o=r+1,d=i+1,f=new Int32Array(o*d),u=i-1;u>=0;--u)for(var h=r-1;h>=0;--h){var s=n(h,u,f,o),l=s.rightEdge,c=s.bottomEdge,v=s.bottomRightEdge;f[u*o+h]=e(a[u*r+h],h,u)+l+c-v}return{data:f,height:d,width:o}}function a(t,e,r){for(var i=t.width,a=t.height,o=t.data,d=e.data,f=i+1,u=a+1,h=new Int32Array(f*u),s=a-1;s>=0;--s)for(var l=i-1;l>=0;--l){var c=n(l,s,h,f),v=c.rightEdge,g=c.bottomEdge,p=c.bottomRightEdge,w=s*i+l;h[s*f+l]=r(o[w],d[w],l,s)+v+g-p}return{data:h,height:u,width:f}}function o(t,e,r){for(var n=t.width,i=t.height,a=t.data,o=n-1,d=i-1,f=o-e+1,u=d-e+1,h=new Int32Array(f*u),s=0;s<d;++s)for(var l=0;l<o;++l)if(l<f&&s<u){var c=a[n*s+l]-a[n*s+l+e]-a[n*(s+e)+l]+a[n*(s+e)+l+e];h[s*f+l]=c/r}return{height:u,width:f,data:h}}function d(t,e){return o(i(t,(function(t){return t})),e,1)}function f(t,e,r){for(var n=r*r,a=o(i(t,(function(t){return t*t})),r,1),d=0;d<e.data.length;++d){var f=e.data[d]/n,u=a.data[d]/n,h=f*f;a.data[d]=1024*(u-h)}return a}function u(t,e,r,n,i){for(var d=i*i,f=o(a(t,e,(function(t,e){return t*e})),i,1),u=0;u<r.data.length;++u)f.data[u]=1024*(f.data[u]/d-r.data[u]/d*(n.data[u]/d));return f}Object.defineProperty(e,"__esModule",{value:!0}),e.weberSsim=e.windowCovariance=e.windowVariance=e.windowSums=e.windowMatrix=e.partialSumMatrix2=e.partialSumMatrix1=void 0,e.partialSumMatrix1=i,e.partialSumMatrix2=a,e.windowMatrix=o,e.windowSums=d,e.windowVariance=f,e.windowCovariance=u,e.weberSsim=function(t,e,n){for(var i=n.bitDepth,a=n.k1,o=n.k2,h=n.windowSize,s=Math.pow(2,i)-1,l=a*s*(a*s),c=o*s*(o*s),v=h*h,g=r(r({},t),{data:Int32Array.from(t.data,(function(t){return t+.5}))}),p=r(r({},e),{data:Int32Array.from(e.data,(function(t){return t+.5}))}),w=d(g,h),m=f(g,w,h),y=d(p,h),b=f(p,y,h),M=u(g,p,w,y,h),x=w.data.length,S=0,_=new Array(x),A=0;A<x;++A){var P=w.data[A]/v,O=y.data[A]/v,D=m.data[A]/1024,j=b.data[A]/1024,k=(2*P*O+l)*(M.data[A]/1024*2+c)/(P*P+O*O+l)/(D+j+c);_[A]=k,0==A?S=k:S+=(k-S)/(A+1)}return{data:_,width:w.width,height:w.height,mssim:S}}}},e={};return function r(n){if(e[n])return e[n].exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}(607)}()},function(t,e,r){"use strict";var n=r(3);t.exports=function(t,e,r,d,u,h){if(!a(t)||!a(e)||r&&!a(r))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(t.length!==e.length||r&&r.length!==t.length)throw new Error("Image sizes do not match.");if(t.length!==d*u*4)throw new Error("Image data size does not match width/height.");h=Object.assign({},i,h);for(var s=d*u,l=new Uint32Array(t.buffer,t.byteOffset,s),g=new Uint32Array(e.buffer,e.byteOffset,s),p=!0,w=0;w<s;w++)if(l[w]!==g[w]){p=!1;break}if(p){if(r&&!h.diffMask)for(var m=0;m<s;m++)v(t,4*m,h.alpha,r);return 0}for(var y=35215*h.threshold*h.threshold,b=0,M=0;M<u;M++)for(var x=0;x<d;x++){var S=4*(M*d+x),_=f(t,e,S,S);Math.abs(_)>y?h.includeAA||!o(t,x,M,d,u,e)&&!o(e,x,M,d,u,t)?(r&&c.apply(void 0,[r,S].concat(n(_<0&&h.diffColorAlt||h.diffColor))),b++):r&&!h.diffMask&&c.apply(void 0,[r,S].concat(n(h.aaColor))):r&&(h.diffMask||v(t,S,h.alpha,r))}return b};var i={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffColorAlt:null,diffMask:!1};function a(t){return ArrayBuffer.isView(t)&&1===t.constructor.BYTES_PER_ELEMENT}function o(t,e,r,n,i,a){for(var o,u,h,s,l=Math.max(e-1,0),c=Math.max(r-1,0),v=Math.min(e+1,n-1),g=Math.min(r+1,i-1),p=4*(r*n+e),w=e===l||e===v||r===c||r===g?1:0,m=0,y=0,b=l;b<=v;b++)for(var M=c;M<=g;M++)if(b!==e||M!==r){var x=f(t,t,p,4*(M*n+b),!0);if(0===x){if(++w>2)return!1}else x<m?(m=x,o=b,u=M):x>y&&(y=x,h=b,s=M)}return 0!==m&&0!==y&&(d(t,o,u,n,i)&&d(a,o,u,n,i)||d(t,h,s,n,i)&&d(a,h,s,n,i))}function d(t,e,r,n,i){for(var a=Math.max(e-1,0),o=Math.max(r-1,0),d=Math.min(e+1,n-1),f=Math.min(r+1,i-1),u=4*(r*n+e),h=e===a||e===d||r===o||r===f?1:0,s=a;s<=d;s++)for(var l=o;l<=f;l++)if(s!==e||l!==r){var c=4*(l*n+s);if(t[u]===t[c]&&t[u+1]===t[c+1]&&t[u+2]===t[c+2]&&t[u+3]===t[c+3]&&h++,h>2)return!0}return!1}function f(t,e,r,n,i){var a=t[r+0],o=t[r+1],d=t[r+2],f=t[r+3],c=e[n+0],v=e[n+1],g=e[n+2],p=e[n+3];if(f===p&&a===c&&o===v&&d===g)return 0;f<255&&(a=l(a,f/=255),o=l(o,f),d=l(d,f)),p<255&&(c=l(c,p/=255),v=l(v,p),g=l(g,p));var w=u(a,o,d),m=u(c,v,g),y=w-m;if(i)return y;var b=h(a,o,d)-h(c,v,g),M=s(a,o,d)-s(c,v,g),x=.5053*y*y+.299*b*b+.1957*M*M;return w>m?-x:x}function u(t,e,r){return.29889531*t+.58662247*e+.11448223*r}function h(t,e,r){return.59597799*t-.2741761*e-.32180189*r}function s(t,e,r){return.21147017*t-.52261711*e+.31114694*r}function l(t,e){return 255+(t-255)*e}function c(t,e,r,n,i){t[e+0]=r,t[e+1]=n,t[e+2]=i,t[e+3]=255}function v(t,e,r,n){var i=l(u(t[e+0],t[e+1],t[e+2]),r*t[e+3]/255);c(n,e,i,i,i)}},function(t,e,r){var n=r(4),i=r(5),a=r(6),o=r(7);t.exports=function(t){return n(t)||i(t)||a(t)||o()}},function(t,e,r){var n=r(0);t.exports=function(t){if(Array.isArray(t))return n(t)}},function(t,e){t.exports=function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,e,r){var n=r(0);t.exports=function(t,e){if(t){if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,r){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function i(t,e){if(t){if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}function a(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.r(e);var o=r(1),d=r.n(o),f=r(2),u=r.n(f);function h(t){return 3===t.length?"rgb(".concat(t[0],",").concat(t[1],",").concat(t[2],")"):"rgba(".concat(t[0],",").concat(t[1],",").concat(t[2],",").concat(t[3],")")}function s(t,e){if(t&&0!==e.vertices.length){t.fillStyle=h(e.color),t.beginPath();var r=e.vertices[0];t.moveTo(r.x,r.y);for(var n=1;n<e.vertices.length;n++)r=e.vertices[n],t.lineTo(r.x,r.y);t.closePath(),t.fill()}}function l(t,e,r,n){var i=2*Math.random()*Math.PI,a=Math.random()*e,o=t.x+Math.floor(Math.cos(i)*a);o=Math.max(0,Math.min(o,r));var d=t.y+Math.floor(Math.sin(i)*a);return{x:o,y:d=Math.max(0,Math.min(d,n))}}function c(t,e,r,n,i){for(var a=[],o=n/2,d=i/2,f=0;f<t;f++){for(var u=v(0,n,!0),h=v(0,i,!0),s=0;s<e;s++){var l=u+v(-o,o,!0);l=Math.max(0,Math.min(l,n));var c=h+v(-d,d,!0);c=Math.max(0,Math.min(c,i)),a.push(l),a.push(c)}for(var g=0;g<r;g++){var p=g<3?v(0,256,!0):v(.2,1,!1);a.push(p)}}return{id:Date.now(),genes:a,fitness:0,ssim:0,pixelDiff:0,subPixel:0,diff:void 0,probability:0,phenotype:[]}}function v(t,e,r){var n=Math.random()*(e-t)+t;return n=r?Math.floor(n):Math.round(1e3*n)/1e3}function g(t){var e,r=0,n=[],o=a(t),d=function(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=i(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,d=!0,f=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return d=t.done,t},e:function(t){f=!0,o=t},f:function(){try{d||null==r.return||r.return()}finally{if(f)throw o}}}}(t);try{for(d.s();!(e=d.n()).done;){var f=e.value,u=f.fitness*f.fitness;n.push(u),r+=u}}catch(l){d.e(l)}finally{d.f()}for(var h=0,s=0;s<n.length;s++){h+=n[s]/r,o[s].probability=h}return o[o.length-1].probability=1,o}function p(t){for(var e=Math.random(),r=0;r<t.length&&t[r].probability<=e;)r++;return r===t.length&&(r-=1),t[r]}function w(t,e){for(var r={id:0,genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,diff:void 0,probability:0,phenotype:[]},n=0;n<e;n++){var i=t[Math.floor(Math.random()*t.length)];(0===r.id||i.fitness>r.fitness)&&(r=i)}return r}function m(t,e,r,n,i,a){switch(r){case"polygon":return function(t,e,r,n,i){var a={genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},o=t.fitness>e.fitness?r:1-r,d=0;for(;d<t.genes.length;){var f=2*n+i,u=Math.random()<o?t.genes:e.genes;a.genes=a.genes.concat(u.slice(d,d+f)),d+=f}return a}(t,e,n,i,a);case"vertex":return function(t,e,r,n,i){var a={genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},o=t.fitness>e.fitness?r:1-r,d=0;for(;d<t.genes.length;){if(d%(2*n+i)<2*n){var f=Math.random()<o?t.genes:e.genes,u={x:f[d],y:f[d+1]};a.genes.push(u.x),a.genes.push(u.y),d+=2}else{var h=Math.random()<o?t.genes:e.genes;a.genes.push(h[d]),a.genes.push(h[d+1]),a.genes.push(h[d+2]),d+=3,4===i&&(a.genes.push(h[d]),d++)}}return a}(t,e,n,i,a);case"data":return function(t,e,r,n,i){var a={genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},o=t.fitness>e.fitness?r:1-r,d=0;for(;d<t.genes.length;){var f=Math.random()<o?t.genes:e.genes;a.genes.push(f[d]),d++}return a}(t,e,n);default:return function(t,e,r,n,i){var a={genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},o=2*n+i,d=n/o,f=Math.floor(d*r)*o,u=t.fitness>e.fitness?t.genes:e.genes,h=t.fitness>e.fitness?e.genes:t.genes;return a.genes=a.genes.concat(u.slice(0,f)),a.genes=a.genes.concat(h.slice(f)),a}(t,e,n,i,a)}}e.default={};function y(t,e,r,n,i,a,o,f,h,l,c){t.phenotype=function(t,e,r){for(var n=[],i=2*e+r,a=0;a<t.length;a+=i){for(var o={vertices:[],color:[]},d=2*e,f=0;f<d;f+=2){var u={x:t[a+f],y:t[a+f+1]};o.vertices.push(u)}for(var h=0;h<r;h++)o.color.push(t[a+d+h]);n.push(o)}return n}(t.genes,f,h),c.clearRect(0,0,l.width,l.height),c.fillStyle="#000000",c.fillRect(0,0,l.width,l.height);for(var v=0;v<t.phenotype.length;v++){s(c,t.phenotype[v])}var g=c.getImageData(0,0,l.width,l.height),p={mssim:0},w=i;if(e){p=d()(l,g,{rgb2grayVersion:"original",windowSize:11,k1:.01,k2:.03,bitDepth:8,downsample:"original",ssim:"weber"})}else w=0;var m=void 0,y=0,b=a;if(r){var M=new OffscreenCanvas(l.width,l.height).getContext("2d"),x=0;M&&(m=M.createImageData(l.width,l.height),x=u()(l.data,g.data,m.data,l.width,l.height,{threshold:.1})),y=(l.width*l.height-x)/(l.width*l.height)}else b=0;var S=0,_=o;if(n){for(var A=0,P=l.width*l.height*h,O=0;O<P;O++)A+=Math.abs(l.data[O]-g.data[O]);S=1-A/(l.width*l.height*h*256)}else _=0;return{fitness:(p.mssim*w+y*b+S*_)/(w+b+_),ssim:p.mssim,pixelDiff:y,subPixel:S,diff:m}}function b(t,e,r,n,i,a,o,d,f){for(var u={genes:[],fitness:0,ssim:0,pixelDiff:0,subPixel:0,diff:void 0,probability:0,id:Date.now(),phenotype:[]},h=f?1:e,s=0,c=2*i+a;s<t.genes.length;)if(Math.random()<h){var g=s%c,p=g>=2*i;if(g%2===0&&g<2*i){var w={x:t.genes[s],y:t.genes[s+1]},m=Math.max(o,d)*r,y=v(-m,m,!1);y>-1&&y<=0&&(y=-1),y<1&&y>=0&&(y=1),w=l(w,y,o,d),u.genes.push(w.x),u.genes.push(w.y),s+=2}else if(p){var b=v(-n,n,!1),M=t.genes[s]+t.genes[s]*b;4===a&&g===c-1?M=Math.max(.2,Math.min(M,1)):(M=Math.round(M),M=Math.max(0,Math.min(M,255))),u.genes.push(M),s++}else u.genes.push(t.genes[s]),s++}else u.genes.push(t.genes[s]),s++;return u.genes=u.genes.concat([]),u}self.addEventListener("message",(function(t){if(t){var e=t.data,r=e.configuration,n=r.enableTransparency?4:3,i=e.population,o=e.best,d=e.image,f=new OffscreenCanvas(e.renderingWidth,e.renderingHeight).getContext("2d"),u=new OffscreenCanvas(e.renderingWidth,e.renderingHeight).getContext("2d");if(f&&u){u.putImageData(d,0,0);var h=u.getImageData(0,0,e.renderingWidth,e.renderingHeight),s=[],l=(new Date).getTime();if(0===i.length)s=function(t,e,r,n,i,o,d,f,u,h,s){if(!s)return a(t);for(var l=[],c=0;c<t.length;c++){var v=t[c],g=y(v,e,r,n,i,o,d,f,u,h,s),p={genes:a(v.genes),fitness:g.fitness,ssim:g.ssim,pixelDiff:g.pixelDiff,subPixel:g.subPixel,diff:g.diff,probability:0,id:v.id,phenotype:a(v.phenotype)};l.push(p)}return l}(s=function(t,e,r,n,i,a){for(var o=[],d=0;d<t;d++){var f=c(e,r,n,i,a);o.push(f)}return o}(r.population,r.nbPolygons,r.nbVertex,n,e.renderingWidth,e.renderingHeight),r.enableSsim,r.enablePixelDiff,r.enableSubDiff,r.ratioSsim,r.ratioPixelDiff,r.ratioSubDiff,r.nbVertex,n,h,f);else{o.id!==i[0].id&&(i=g([].concat(a(i),[o])));for(var v=function(t,e){for(var r=[],n=0;n<e;n++){var i=p(t);r.push(i)}return r}(i=a(i).sort((function(t,e){return t.probability-e.probability})),Math.round(i.length*r.selectCutoff)),M=0;M<r.population;M++){var x=Math.random();if(x<r.keepPreviousRatio){var S=b(p(i),r.mutationRate,r.vertexMovement,r.colorModificationRate,r.nbVertex,n,e.renderingWidth,e.renderingHeight,!1),_=y(S,r.enableSsim,r.enablePixelDiff,r.enableSubDiff,r.ratioSsim,r.ratioPixelDiff,r.ratioSubDiff,r.nbVertex,n,h,f);S.fitness=_.fitness,S.ssim=_.ssim,S.pixelDiff=_.pixelDiff,S.diff=_.diff,s.push(S)}else if(x<r.keepPreviousRatio+r.newIndividualRatio){var A=c(r.nbPolygons,r.nbVertex,n,e.renderingWidth,e.renderingHeight),P=y(A,r.enableSsim,r.enablePixelDiff,r.enableSubDiff,r.ratioSsim,r.ratioPixelDiff,r.ratioSubDiff,r.nbVertex,n,h,f);A.fitness=P.fitness,A.ssim=P.ssim,A.pixelDiff=P.pixelDiff,A.diff=P.diff,s.push(A)}else{var O=void 0,D=void 0;"tournament"===r.parentSelectionStrategy?(O=w(v,r.tournamentSize),D=w(v,r.tournamentSize)):(O=p(i),D=p(i));var j=m(O,D,r.crossoverStrategy,r.crossoverParentRatio,r.nbVertex,n),k=y(j=b(j,r.mutationRate,r.vertexMovement,r.colorModificationRate,r.nbVertex,n,e.renderingWidth,e.renderingHeight,!1),r.enableSsim,r.enablePixelDiff,r.enableSubDiff,r.ratioSsim,r.ratioPixelDiff,r.ratioSubDiff,r.nbVertex,n,h,f);j.fitness=k.fitness,j.ssim=k.ssim,j.pixelDiff=k.pixelDiff,j.diff=k.diff,s.push(j)}}}s=function(t){return a(t).sort((function(t,e){return e.fitness-t.fitness}))}(s);var I,E=((new Date).getTime()-l)/1e3,z=e.notImprovingSince;o&&o.fitness>s[0].fitness?(I=o,z++):(I=s[0],z=0);var C={isRunning:!0,best:I,population:s,generation:e.generation+1,elapsedTime:E,notImprovingSince:z};postMessage(C)}else{console.error("no ctx to draw the image");var R={isRunning:!0,best:o,population:a(i),generation:e.generation,elapsedTime:0,notImprovingSince:0};postMessage(R)}}}))}]);
//# sourceMappingURL=test.worker.e311e25b.js.map